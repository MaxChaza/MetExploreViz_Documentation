/* 
This file is part of MetExploreViz 
 
Copyright (c) 2016 INRA 
 
Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
GNU General Public License Usage 
This file may be used under the terms of the GNU General Public License version 3.0 as 
published by the Free Software Foundation and appearing in the file LICENSE included in the 
packaging of this file. 
 
Please review the following information to ensure the GNU General Public License version 3.0 
requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 
If you are unsure which license is appropriate for your use, please contact us 
at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
Version: 1 Build date: 2016-04-13 9:34:37 
*/ 
metExploreD3.GraphNetwork={zoomListener:"",task:"",delayedInitialisation:function(a){var b={};b.render=function(){var c=d3.select("#"+a);c.append("svg").attr("width","100%").attr("height","100%").attr("class","D3viz").attr("id","D3viz").style("background-color","#fff")};b.render();metExploreD3.GraphLink.delayedInitialisation(a);metExploreD3.GraphNode.delayedInitialisation(a);return b},tick:function(h){if(_metExploreViz.getComparedPanelById(h)!=null||h=="viz"){var s=metExploreD3.getScaleById(h);metExploreD3.GraphLink.tick(h,s);metExploreD3.GraphNode.tick(h);var q=s.getZoomScale();var n=metExploreD3.GraphNetwork.isAnimated(h);var b=_metExploreViz.getSessionById(h);var l=metExploreD3.getGeneralStyle();if(n&&q>0.05&&b.isResizable()){var e=document.getElementById(h).getBoundingClientRect();var a=d3.select("#"+h).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();if(e.top>a.top||e.left>a.left||e.bottom<a.bottom||e.right<a.right){var f=b.getD3Data().getNodesLength();var r=3000;if(f<l.getReactionThreshold()||!l.isDisplayedLabelsForOpt()){r=3000}metExploreD3.fixDelay(metExploreD3.GraphNetwork.task,r);var d=s.getZoom();var k=parseInt(d3.select("#"+h).select("#D3viz").style("width"));var j=parseInt(d3.select("#"+h).select("#D3viz").style("height"));var p=0.01*f/100;var o=q-(q*p);d.scale(o);var g=o*k;var m=o*j;var t=(k-g)/2;var c=(j-m)/2;d.translate([t,c]);d.event(d3.select("#"+h).select("#D3viz"));s.setZoomScale(o);s.setXScale(d.x());s.setYScale(d.y())}}}},zoom:function(a){var c=metExploreD3.getScaleById(a);d3.select("#"+a).select("#D3viz").select("#graphComponent").attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")");var b=c.getZoom();c.setZoomScale(d3.event.scale);c.setXScale(b.x());c.setYScale(b.y());metExploreD3.GraphLink.tick(a,c)},zoomIn:function(){_MyThisGraphNode.dblClickable=false;var b=this.parentNode.parentNode.id;var h=metExploreD3.getScaleById(b);var d=h.getZoom();var e=_metExploreViz.getSessionById(b);var g=document.getElementById(b).getBoundingClientRect();var f=d3.select("#"+b).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var d=h.getZoom();var c=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var a=parseInt(d3.select("#"+b).select("#D3viz").style("height"));d.scale(h.getZoomScale()*1.1);d.event(d3.select("#"+b).select("#D3viz"));h.setXScale(d.x());h.setYScale(d.y());h.setZoomScale(h.getZoomScale()*1.1);metExploreD3.GraphLink.tick(b,h)},zoomOut:function(){_MyThisGraphNode.dblClickable=false;var b=this.parentNode.parentNode.id;var h=metExploreD3.getScaleById(b);var d=h.getZoom();var e=_metExploreViz.getSessionById(b);var g=document.getElementById(b).getBoundingClientRect();var f=d3.select("#"+b).select("#D3viz")[0][0].getElementById("graphComponent").getBoundingClientRect();var d=h.getZoom();var c=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var a=parseInt(d3.select("#"+b).select("#D3viz").style("height"));d.scale(h.getZoomScale()*0.9);d.event(d3.select("#"+b).select("#D3viz"));h.setXScale(d.x());h.setYScale(d.y());h.setZoomScale(h.getZoomScale()*0.9);metExploreD3.GraphLink.tick(b,h)},animationButtonOn:function(a){d3.select("#"+a).select("#buttonAnim").select("image").remove();d3.select("#"+a).select("#buttonAnim").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/pause.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");metExploreD3.GraphNetwork.setAnimated(a,true)},animationButtonOff:function(a){d3.select("#"+a).select("#buttonAnim").select("image").remove();d3.select("#"+a).select("#buttonAnim").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/play.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");metExploreD3.GraphNetwork.setAnimated(a,false)},play:function(g){var h=_metExploreViz.getSessionsSet();var a=this.parentNode.parentNode.id;var f=_metExploreViz.getSessionById(a);if(f!=undefined){var e=metExploreD3.GraphNetwork.isAnimated(a);if(e=="false"){if(f.isLinked()){for(var b in h){if(h[b].isLinked()){metExploreD3.GraphNetwork.animationButtonOn(h[b].getId())}}var c=_metExploreViz.getSessionById("viz").getForce();c.start()}else{metExploreD3.GraphNetwork.animationButtonOn(a);var c=f.getForce();c.start()}}else{if(f.isLinked()){for(var b in h){if(h[b].isLinked()){metExploreD3.GraphNetwork.animationButtonOff(h[b].getId())}}var c=_metExploreViz.getSessionById("viz").getForce();c.stop()}else{metExploreD3.GraphNetwork.animationButtonOff(a);var c=f.getForce();c.stop()}}}},setLink:function(f){that=this;var a=this.parentNode.parentNode.id;var e=_metExploreViz.getSessionById(a);var b=_metExploreViz.getSessionById("viz");if(e!=undefined){var c=e.getForce();var g=d3.select(this).attr("isLink");d3.select(this).select("image").remove();if(g=="false"){metExploreD3.GraphNetwork.link(that)}else{metExploreD3.GraphNetwork.unLink(that)}}},link:function(d){var a=d.parentNode.parentNode.id;var f=_metExploreViz.getSessionById(a);var c=_metExploreViz.getSessionById("viz");var e=metExploreD3.GraphNetwork.isAnimated("viz");d3.select(d).attr("isLink","true");f.setLinked(true);c.setLinked(true);if(e=="true"){metExploreD3.GraphNetwork.animationButtonOn(a)}else{metExploreD3.GraphNetwork.animationButtonOff(a)}var g=d3.select(d).attr("isLink");d3.select(d).select("image").remove();d3.select(d).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/link.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");if(f!=undefined){if(c.getDuplicatedNodesCount()>0){var b=d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getBiologicalType()=="metabolite"});c.getDuplicatedNodes().forEach(function(h){b.filter(function(j){return j.getId()==h}).each(function(j){j.setIsSideCompound(true)})});metExploreD3.GraphNetwork.duplicateSideCompoundsById(c.getDuplicatedNodes(),a);metExploreD3.GraphNetwork.looksLinked();if(f.isLinked()){metExploreD3.GraphNetwork.graphAlignment(a)}}else{metExploreD3.GraphNetwork.graphAlignment(a)}}metExploreD3.GraphNetwork.initCentroids()},unLink:function(b){var a=b.parentNode.parentNode.id;var e=_metExploreViz.getSessionById(a);d3.select(b).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/unlink.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");d3.select(b).attr("isLink","false");e.setLinked(false);metExploreD3.GraphNetwork.looksLinked();var d=metExploreD3.GraphNetwork.isAnimated(a);if(d=="true"){var c=e.getForce();c.start()}},looksLinked:function(){var c=_metExploreViz.getSessionsSet();var b=_metExploreViz.getSessionById("viz");b.setLinked(false);for(var a in c){if(c[a].isLinked()){b.setLinked(true)}}},refreshSvg:function(k){var e=_metExploreViz.getSessionById(k).getD3Data();var n=e.getNodes();metExploreD3.fireEventParentWebSite("refreshCart",n);var l=[];for(var r=0;r<n.length-1;r++){l.push(n[r].name)}l=l.sort();var s=parseInt(metExploreD3.GraphPanel.getHeight(k));var j=parseInt(metExploreD3.GraphPanel.getWidth(k));var u=metExploreD3.getLinkStyle();var o=metExploreD3.getGeneralStyle();var b=d3.layout.force().friction(0.9).gravity(0.06).charge(-150).linkDistance(function(h){if(h.getSource().getIsSideCompound()||h.getTarget().getIsSideCompound()){return u.getSize()/2}else{return u.getSize()}}).size([j,s]);var a=_metExploreViz.getSessionById(k);a.setActivity(true);a.setForce(b);if(k=="viz"){metExploreD3.GraphCaption.drawCaption()}var y=d3.scale.linear().domain([0,j]).range([0,j]);var d=d3.scale.linear().domain([s,0]).range([s,0]);if(a.getScale()==undefined){var g=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(y).y(d).scaleExtent([0.01,20]).on("zoom",function(w){var h=_metExploreViz.getSessionById(k);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){g.zoom(k)}});var x=new Scale(k);x.setScale(y,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener);metExploreD3.setScale(x,k)}else{var g=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(y).y(d).scaleExtent([0.01,30]).on("zoom",function(w){var h=_metExploreViz.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){g.zoom(this.parentNode.id)}});var x=new Scale(k);x.setScale(y,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener);metExploreD3.setScale(x,k)}b.on("start",function(){if(e.getNodes().length>o.getReactionThreshold()&&o.isDisplayedLinksForOpt()){d3.selectAll("path.link").remove()}});b.on("end",function(){var h=metExploreD3.getScaleById(k);if((e.getNodes().length>o.getReactionThreshold()&&o.isDisplayedLinksForOpt())){metExploreD3.GraphLink.reloadLinks(k,e,u,v)}metExploreD3.GraphLink.tick(k,h)});var m=d3.select("#"+k);m.svg=m.select("#D3viz").selectAll("*").remove();_metExploreViz.setLinkedByTypeOfMetabolite(false);var t;var f=false;var c=d3.select("#"+k).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(y).y(d).on("brushstart",function(A){document.addEventListener("mousedown",function(C){if(C.button===1){C.stopPropagation();C.preventDefault();C.stopImmediatePropagation()}});var w=d3.select("#"+k).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var z=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&w!="true"){if(z!=undefined){if(z.isLinked()){var B=_metExploreViz.getSessionById("viz");if(B!=undefined){var h=B.getForce();if(h!=undefined){h.stop()}}}else{var h=z.getForce();if(h!=undefined){h.stop()}}}f=true;d3.select("#"+k).select("#brush").classed("hide",false);d3.select("#"+k).select("#D3viz").on("mousedown.zoom",null);t=d3.select("#"+k).select("#graphComponent").selectAll("g.node");t.each(function(C){C.previouslySelected=C.isSelected()})}else{var h=z.getForce();if(h!=undefined){h.stop()}d3.select("#"+k).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&f){var F=d3.event.target.extent();if(F[1][0]-F[0][0]>20||F[1][1]-F[0][1]>20){var C;var F=d3.event.target.extent();var z=metExploreD3.getScaleById(k);var B=z.getZoomScale();var w=metExploreD3.createLoadMask("Selection in progress...",k);if(w!=undefined){metExploreD3.showMask(w);metExploreD3.deferFunction(function(){t.classed("selected",function(M){var L=z.getXScale();var K=z.getYScale();C=(L(F[0][0])<=L(M.x)&&L(M.x)<L(F[1][0]))&&(K(F[0][1])<=K(M.y)&&K(M.y)<K(F[1][1]));if((M.isSelected()==false&&C==true)||(M.isSelected()==true&&C==false&&!M.previouslySelected)){_MyThisGraphNode.selection(M,k)}return C});metExploreD3.hideMask(w);var I=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(I!=undefined){if(I.isLinked()){var J=_metExploreViz.getSessionById("viz");if(J!=undefined){var G=metExploreD3.GraphNetwork.isAnimated(J.getId());if(G=="true"){var H=J.getForce();if(H!=undefined){if((metExploreD3.GraphNetwork.isAnimated(J.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(J.getId())==null)){H.start()}}}}}else{var H=I.getForce();var G=metExploreD3.GraphNetwork.isAnimated(I.getId());if(G=="true"){var H=I.getForce();if(H!=undefined){if((metExploreD3.GraphNetwork.isAnimated(I.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(I.getId())==null)){H.start()}}}}}f=false},100)}}}else{var D=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(D!=undefined){if(D.isLinked()){var A=_metExploreViz.getSessionById("viz");if(A!=undefined){var E=metExploreD3.GraphNetwork.isAnimated(A.getId());if(E=="true"){var h=A.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(A.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(A.getId())==null)){h.start()}}}}}else{var h=D.getForce();var E=metExploreD3.GraphNetwork.isAnimated(D.getId());if(E=="true"){var h=D.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(D.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(D.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var z=metExploreD3.getScaleById(k);d3.select("#"+k).selectAll("#D3viz").style("cursor","default");d3.select("#"+k).selectAll("#D3viz").call(z.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));m.svg=d3.select("#"+k).select("#D3viz").call(metExploreD3.GraphNetwork.zoomListener).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");if(a!=undefined){var b=a.getForce();if(a.isResizable()!=undefined&&a.isResizable()!=false){metExploreD3.GraphNetwork.task.cancel()}a.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){a.setResizable(false)})}d3.select("#"+k).select("#D3viz").attr("animation",function(){if(a.isAnimated()){return true}else{return false}}).append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",function(){if(a.isAnimated()){return document.location.href.split("index.html")[0]+"resources/icons/pause.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/play.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","whiteBlack").attr("id","whiteBlack").attr("x",(j-100)).attr("y",100).on("click",function(){if(d3.select("#"+k).style("-webkit-filter").search("grayscale")==-1&&d3.select("#"+k).style("filter").search("grayscale")==-1){d3.select("#"+k).style("filter","grayscale(100%)").style("-webkit-filter","grayscale(100%)")}else{d3.select("#"+k).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/blackWhite.png").attr("width","50").attr("height","50").attr("transform","translate("+(j-100)+",100) scale(0.5)");d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","invertColor").attr("id","invertColor").attr("x",(j-100)).attr("y",150).on("click",function(){if(d3.select("#"+k).style("-webkit-filter").search("invert")==-1&&d3.select("#"+k).style("filter").search("invert")==-1){d3.select("#"+k).style("filter","invert(100%)").style("-webkit-filter","invert(100%)")}else{d3.select("#"+k).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/invertColor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(j-100)+",150) scale(0.5)");d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(j-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(j-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(j-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(j-160)+",10) scale(1)");d3.select("#"+k).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+k).on("mouseover",function(){d3.select("#"+k).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+k).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var w=_metExploreViz.getSessionById(k);if(w.isActive()){var h=d3.select("#"+k).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+k).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+k).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+k).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+k).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+k).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});if(a.isAnimated()){metExploreD3.GraphNetwork.setAnimated(k,true)}else{metExploreD3.GraphNetwork.setAnimated(k,false)}var u=metExploreD3.getLinkStyle();var v=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.refreshLink(k,a,u,v);metExploreD3.GraphNode.refreshNode(k);var q=document.createElement("div");q.className="tooltip2";q.id="tooltip2";document.getElementById("viz-body").appendChild(q);q.classList.add("hide");if(k!="viz"){d3.select("#"+k).select("#D3viz").append("svg:g").attr("class","buttonLink").attr("id","buttonLink").attr("isLink","false").on("click",metExploreD3.GraphNetwork.setLink).style("cursor","hand").append("image").attr("xlink:href",function(){if(a.isLinked()){return document.location.href.split("index.html")[0]+"resources/icons/link.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/unlink.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)")}else{metExploreD3.GraphNetwork.looksLinked();if(a.isLinked()){metExploreD3.GraphNetwork.graphAlignment(k)}}var e=a.getD3Data();var b=a.getForce();b.nodes(e.getNodes()).links(e.getLinks()).on("tick",function(A){var w=metExploreD3.getGeneralStyle().useClusters();var z=metExploreD3.getGeneralStyle().isDisplayedConvexhulls();if(w&&z!=false){var h=A.alpha*0.1;e.getNodes().forEach(function(G){if(z=="Compartments"){var H=null;if(G.getBiologicalType()=="metabolite"){H=G.getCompartment()}else{var F=[];for(var E in a.groups){if(a.groups.hasOwnProperty(E)){var C=a.groups[E].values.indexOf(G);if(C!=-1){F.push(a.groups[E].key)}}}if(F.length<2){H=F[0]}}if(H!=null){var D=_metExploreViz.getSessionById(k).getForceCentroids();var B=D.nodes().find(function(I){return I.id==H});G.x+=(B.x-G.x)*h;G.y+=(B.y-G.y)*h}}else{if(z=="Pathways"&&G.getPathways().length<2){var H=a.getGroupByKey(G.getPathways()[0]);if(H!=null){var D=_metExploreViz.getSessionById(k).getForceCentroids();var B=D.nodes().find(function(I){return I.id==G.getPathways()[0]});G.x+=(B.x-G.x)*h;G.y+=(B.y-G.y)*h}}}})}if(b.alpha()>=0.005){setTimeout(metExploreD3.GraphNetwork.tick(k),0)}});if(a.isAnimated()){b.start()}else{b.start();b.stop();metExploreD3.GraphNetwork.tick(k)}var p=o.isDisplayedConvexhulls();if(p&&k=="viz"){metExploreD3.GraphLink.displayConvexhulls(k)}a.setForce(b)},initCentroids:function(){var a="viz";var f=parseInt(metExploreD3.GraphPanel.getHeight(a));var l=parseInt(metExploreD3.GraphPanel.getWidth(a));var e=metExploreD3.getLinkStyle();var k=metExploreD3.getGeneralStyle();var j=_metExploreViz.getSessionById(a);var d=j.getD3Data();var b=d3.layout.force().friction(0.9).gravity(0.08).charge(-4000).theta(0.2).linkDistance(600).size([l,f]);j.setForceCentroids(b);var c=metExploreD3.getGeneralStyle().isDisplayedConvexhulls();var g=[];if(c=="Compartments"){d.getCompartments().forEach(function(h){g.push({id:h.identifier,x:2,y:2})});var m=[];d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getBiologicalType()=="reaction"}).filter(function(p){var o=0;for(var n in j.groups){if(j.groups.hasOwnProperty(n)){var h=j.groups[n].values.indexOf(p);if(h!=-1){o++}}}return o.length>1}).each(function(h){h.getCompartment().forEach(function(n){h.getCompartment().forEach(function(q){if(n!=q){var o=g.findIndex(function(s){return s.id==n});var p=g.findIndex(function(s){return s.id==q});var r=m.find(function(s){return s.source==o&&s.target==p});if(r==undefined){m.push({source:o,target:p})}}})})})}else{d.getPathways().forEach(function(h){g.push({id:h,x:2,y:2})});var m=[];d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(h){return h.getPathways().length>1}).each(function(h){h.getPathways().forEach(function(n){h.getPathways().forEach(function(p){if(n!=p){var o=g.findIndex(function(s){return s.id==n});var q=g.findIndex(function(s){return s.id==p});var r=m.find(function(s){return s.source==o&&s.target==q});if(r==undefined){m.push({source:o,target:q})}}})})})}b.nodes(g).links(m).start()},moveGraph:function(){_MyThisGraphNode.dblClickable=false;var a=this.parentNode.parentNode.id;var b=d3.select("#"+a).select("#buttonHand").attr("scrollable");if(b=="false"){d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1);d3.select("#"+a).select("#buttonHand").attr("scrollable",true)}else{d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2);d3.select("#"+a).select("#buttonHand").attr("scrollable",false)}},graphAlignment:function(a){var d=_metExploreViz.getSessionById(a);if(a!="viz"){var b=_metExploreViz.getSessionById("viz");d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(h){var g=this;var f=d3.select(g).select("rect").style("fill");d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").each(function(n){if(n.getId()==h.getId()){h.x=n.x;h.y=n.y;if(n.getMappingDatasLength()>0){n.getMappingDatas().forEach(function(o){h.addMappingData(new MappingData(h,o.getMappingName().valueOf(),o.getConditionName().valueOf(),o.getMapValue().valueOf()))})}if(h.selected&&!n.isSelected()){_MyThisGraphNode.selection(n,"viz")}if(!h.selected&&n.isSelected()){_MyThisGraphNode.selection(h,a)}var m=d3.select(this).select("rect."+n.getBiologicalType()).style("fill");if(f!=m){d3.select(g).select("rect."+n.getBiologicalType()).style("fill",m);if(n.getBiologicalType()=="metabolite"){var k=metExploreD3.getMetaboliteStyle()}else{var k=metExploreD3.getReactionStyle();var l=metExploreD3.GraphUtils.chooseTextColor(m);d3.select(g).select("text").style("fill",l)}var j=d3.select(this).select("rect."+n.getBiologicalType()).attr("mapped");if(j>0){d3.select(g).insert("rect",":first-child").attr("class","stroke").attr("width",k.getWidth()+4).attr("height",k.getHeight()+4).attr("rx",k.getRX()).attr("ry",k.getRY()).attr("transform","translate(-"+parseInt(k.getWidth()+4)/2+",-"+parseInt(k.getHeight()+4)/2+")").style("opacity","0.5").style("fill","red")}d.setMappingDataType(b.getMappingDataType());d.setMapped(b.isMapped())}}})});d.setActiveMapping(b.getActiveMapping().valueOf());d.resetColorMapping();b.getColorMappingsSet().forEach(function(f){d.addColorMapping(f.getName().valueOf(),f.getValue().valueOf())});var c=d.getForce();c.stop();var e=metExploreD3.getScaleById(a);metExploreD3.GraphLink.tick(a,e);metExploreD3.GraphNode.tick(a)}},scaledX:function(a,b){var h=metExploreD3.getSessionsSet();var g;if(b=="viz"){var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+f).select("#D3viz").style("width"));var c=parseInt(d3.select("#viz").select("#D3viz").style("width"));g=(a*e)/c}else{var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+b).select("#D3viz").style("width"));var c=parseInt(d3.select("#viz").select("#D3viz").style("width"));g=(a*c)/e}return g},scaledY:function(h,a){var g=metExploreD3.getSessionsSet();var b;if(a=="viz"){var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+f).select("#D3viz").style("height"));var c=parseInt(d3.select("#viz").select("#D3viz").style("height"));b=(h*e)/c}else{var f;for(var d in sessions){if(sessions[d].getId()=="viz"){f=sessions[d].getId()}}var e=parseInt(d3.select("#"+a).select("#D3viz").style("height"));var c=parseInt(d3.select("#viz").select("#D3viz").style("height"));b=(h*c)/e}return Scaled},addLinkInDrawing:function(h,b,g,l,a,c){var k=_metExploreViz.getSessionById(c);var f=k.getD3Data();f.addLink(h,b,g,l,a);var j=metExploreD3.getMetaboliteStyle();var e=metExploreD3.getLinkStyle();var d=k.getForce();link=d3.select("#"+c).select("#graphComponent").selectAll("path.link").data(d.links(),function(m){return m.source.id+"-"+m.target.id}).enter().insert("path",":first-child").attr("class",String).attr("d",function(m){return metExploreD3.GraphLink.funcPath4(m,parent)}).attr("class","link").attr("fill-rule","evenodd").attr("fill",function(m){if(m.interaction=="out"){return e.getMarkerOutColor()}else{return e.getMarkerInColor()}}).style("stroke",e.getStrokeColor()).style("stroke-width",0.5).style("opacity",0.5).attr("x1",b.x).attr("y1",b.y).attr("x2",g.x).attr("y2",g.y)},addMetaboliteInDrawing:function(k,o,h,l){var d=o+"-"+h;var a=_metExploreViz.getSessionById(l);var e=a.getD3Data();var b=a.getForce();var u=metExploreD3.getMetaboliteStyle();var s=metExploreD3.getGeneralStyle();var p=d3.behavior.drag().on("dragstart",_MyThisGraphNode.dragstart).on("drag",_MyThisGraphNode.dragmove).on("dragend",_MyThisGraphNode.dragend);var v=metExploreD3.getScaleById(l);metExploreD3.fireEventParentWebSite("sideCompound",k);var c=e.addNode(k.getName(),k.getCompartment(),k.getDbIdentifier(),d,k.getReactionReversibility(),k.getBiologicalType(),false,k.getLabelVisible(),k.getSvg(),k.getSvgWidth(),k.getSvgHeight(),k.getIsSideCompound(),undefined,true,o,e.getNodeById(h).getPathways());if(k.getMappingDatasLength()!=0){k.getMappingDatas().forEach(function(x){e.getNodeById(d).addMappingData(new MappingData(k,x.getMappingName(),x.getConditionName(),x.getMapValue()))})}var r=d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("g.node");var n=false;var q=r.filter(function(x){return x.getId()==o});q.each(function(){n=this.getAttribute("mapped")});r=r.data(b.nodes(),function(x){return x.getId()});r.enter().append("svg:g").attr("class","node").attr("duplicated",function(x){return"true"}).call(p).style("fill","white");r.filter(function(x){return x.getBiologicalType()=="metabolite"}).filter(function(x){return x.getId()==d}).style("stroke-opacity",0.5).addNodeForm(u.getWidth()/2,u.getHeight()/2,u.getRX()/2,u.getRY()/2,u.getStrokeColor(),u.getStrokeWidth()/2);r.filter(function(x){return x.getBiologicalType()=="metabolite"}).filter(function(x){return x.getId()==d}).on("mouseenter",function(y){var x=d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("g.node");d3.select(this).each(function(A){var z=x[0][x.size()-1];this.parentNode.insertBefore(this,z)}).attr("transform","translate("+y.x+", "+y.y+") scale(2)")}).on("mouseover",function(A){A.fixed=true;if(A.getBiologicalType()=="reaction"){d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(B){return A.getId()==B.getSource().getId()}).style("stroke","green");d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(B){return A.getId()==B.getTarget().getId()}).style("stroke","red")}else{d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(B){return A.getId()==B.getSource().getId()}).style("stroke","red");d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(B){return A.getId()==B.getTarget().getId()}).style("stroke","green")}var z=v.getXScale();var y=v.getYScale();var x="<b>Name:</b> "+A.getName()+"<br/><b>Biological type:</b> "+A.getBiologicalType()+((A.getCompartment()!=undefined)?"<br/><b>Compartment:</b> "+A.getCompartment():"")+((A.getDbIdentifier()!=undefined)?"<br/><b>Database identifier:</b> "+A.getDbIdentifier():"")+((A.getEC()!=undefined)?"<br/><b>EC number:</b> "+A.getEC():"")+((A.getReactionReversibility()!=undefined)?"<br/><b>Reaction reversibility:</b> "+A.getReactionReversibility():"")+((A.getIsSideCompound()!=undefined)?"<br/><b>SideCompound:</b> "+A.getIsSideCompound():"")+((A.getMappingDatasLength()!=0)?((A.getMappingDatasLength()==1)?"<br/><b>Mapping:</b><br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>":"<br/>Mappings:<br/><table style='width:100%; margin-left: 30px; padding-right: 30px;'>"):"");A.getMappingDatas().forEach(function(B){x+="<tr><td>"+B.getMappingName()+"</td><td>"+B.getConditionName()+"</td><td>"+B.getMapValue()+"</td></tr>"});x+="</table>";if(A.getSvg()!=""&&A.getSvg()!=undefined&&A.getSvg()!="undefined"){x+='<br/><img src="resources/images/structure_metabolite/'+A.getSvg()+'"/>'}document.getElementById("tooltip2").innerHTML=x;document.getElementById("tooltip2").classList.remove("hide")}).on("mouseleave",function(y){d3.select(this).attr("transform","translate("+y.x+", "+y.y+") scale(1)");if(!y.isSelected()){y.fixed=false}var x=metExploreD3.getLinkStyle();document.getElementById("tooltip2").classList.add("hide");d3.select("#"+l).select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(z){return y.getId()==z.getSource().getId()||y.getId()==z.getTarget().getId()}).style("stroke",x.getStrokeColor());if(y.getBiologicalType()=="reaction"){d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",reactionStyle.getWidth()).attr("height",reactionStyle.getHeight()).attr("transform","translate(-"+reactionStyle.getWidth()/2+",-"+reactionStyle.getHeight()/2+")")}else{d3.select(this).selectAll("rect").selectAll(".reaction, .fontSelected").transition().duration(750).attr("width",u.getWidth()).attr("height",u.getHeight()).attr("transform","translate(-"+u.getWidth()/2+",-"+u.getHeight()/2+")")}});var w=r.filter(function(x){return x.getId()==d});metExploreD3.GraphNode.colorStoreByCompartment(w);if(e.getNodes().length<s.getReactionThreshold()||!s.isDisplayedLabelsForOpt()){var m=Math.min(u.getWidth()/2,u.getHeight()/2);r.filter(function(x){return x.getId()==d}).filter(function(x){return x.getLabelVisible()==true}).filter(function(x){return x.getBiologicalType()=="metabolite"}).filter(function(x){return x.getSvg()=="undefined"||x.getSvg()==undefined||x.getSvg()==""}).append("svg:text").attr("fill","black").attr("class",function(x){return x.getBiologicalType()}).text(function(x){return $("<div/>").html(x.getName()).text()}).style("font-size",function(x){return Math.min((2*m/2),(2*m/2-3)/this.getComputedTextLength()*10)+"px"}).attr("dy",".3em").style("pointer-events","none").style("opacity",0.5);r.filter(function(x){return x.getId()==d}).filter(function(x){return x.getLabelVisible()==true}).filter(function(x){return x.getBiologicalType()=="metabolite"}).filter(function(x){return x.getSvg()!="undefined"&&x.getSvg()!=undefined&&x.getSvg()!=""}).append("svg:text").attr("fill","black").attr("class",function(x){return x.getBiologicalType()}).text(function(x){return $("<div/>").html(x.getName()).text()}).style("font-size",function(x){return Math.min((m)/2,((m-3)/this.getComputedTextLength()*10)/2)+"px"}).attr("dy",".3em").style("pointer-events","none").attr("y",+(3/4*(m/2)));r.filter(function(x){return x.getId()==d}).filter(function(x){return(x.getBiologicalType()=="metabolite"&&x.getSvg()!="undefined"&&x.getSvg()!=undefined&&x.getSvg()!="")}).append("svg").attr("viewBox",function(x){return"0 0 "+m+" "+m}).attr("width",m*8/10+"px").attr("height",m*8/10+"px").attr("x",(-m/2)+(m*1/10)).attr("preserveAspectRatio","xMinYMin").attr("y",(-m/2)+(m*1/10)).attr("class","structure_metabolite").append("image").style("opacity",0.5).attr("xlink:href",function(x){return"resources/images/structure_metabolite/"+x.getSvg()}).attr("width","100%").attr("height","100%");r.filter(function(x){return x.getId()==d}).filter(function(x){return x.getLabelVisible()==true}).filter(function(x){return x.getBiologicalType()=="reaction"}).append("svg:text").attr("fill","black").attr("class",function(x){return x.getBiologicalType()}).text(function(x){return $("<div/>").html(x.getName()).text()}).style("font-size",function(x){return Math.min(2*m,(m-2)/this.getComputedTextLength()*10)+"px"}).attr("dy",".3em")}if(n!=undefined&&n!=false&&n!="false"){if(n==true||n=="true"){r.filter(function(x){return x.getId()==d}).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",u.getWidth()/2+10).attr("height",u.getHeight()/2+10).attr("rx",u.getRX()/2+5).attr("ry",u.getRY()/2+5).attr("transform","translate(-"+parseInt(u.getWidth()/2+10)/2+",-"+parseInt(u.getWidth()/2+10)/2+")").style("opacity","0.5").style("fill","red")}else{var t=n;r.filter(function(x){return x.getId()==d}).attr("mapped",t).style("fill",t)}}var g=100;var f=100;r.filter(function(x){return x.getBiologicalType()=="reaction"}).filter(function(x){return x.getId()==h}).each(function(z){var y=z.x-k.x;var x=z.y-k.y;var A=Math.sqrt(Math.pow(y,2)+Math.pow(x,2));g=z.x-(40*y)/A;f=z.y-(40*x)/A});r.filter(function(x){return x.getBiologicalType()=="metabolite"}).filter(function(x){return x.getId()==d}).attr("transform",function(x){return"translate("+g+","+f+")"}).each(function(x){x.px=g;x.py=f;x.x=g;x.y=f});var j=undefined;a.groups.forEach(function(y){if(j=="compartment"){if(y.key==c.getCompartment()){y.values.push(c)}}else{var x=c.getPathways().find(function(z){return y.key==z});if(x!=undefined){y.values.push(c)}}});if(metExploreD3.GraphNetwork.isAnimated(l)==true||metExploreD3.GraphNetwork.isAnimated(l)=="true"){b.start()}return c},duplicateANode:function(j,b){var k=_metExploreViz.getSessionById(b);k.addDuplicatedNode(j.getId());var c=k.getForce();var h=k.getD3Data();var a,l;l=[];a=[];var d=d3.select("#"+b).select("#D3viz");var e=d3.behavior.drag().on("dragstart",function(m){_MyThisGraphNode.dragstart(m)}).on("drag",function(m){_MyThisGraphNode.dragmove(m)}).on("dragend",_MyThisGraphNode.dragend);var g=metExploreD3.getScaleById(b);d.selectAll("path.link").filter(function(m){return m.getInteraction()!="hiddenForce"}).each(function(o){var m=o.source;var n=o.target;if(m==j){a.push(n)}else{if(n==j){l.push(m)}}});a.forEach(function(o){var m=j.getId()+"-"+o.getId();var n=metExploreD3.GraphNetwork.addMetaboliteInDrawing(j,j.getId(),o.getId(),b);metExploreD3.GraphNetwork.addLinkInDrawing(m+"-"+o.getId(),n,o,"in",o.getReactionReversibility(),b)});l.forEach(function(o){var m=j.getId()+"-"+o.getId();var n=metExploreD3.GraphNetwork.addMetaboliteInDrawing(j,j.getId(),o.getId(),b);metExploreD3.GraphNetwork.addLinkInDrawing(o.getId()+"-"+m,o,n,"out",o.getReactionReversibility(),b)});var f=metExploreD3.getLinkStyle();c.linkDistance(function(m){if(m.getSource().getIsSideCompound()||m.getTarget().getIsSideCompound()){return f.getSize()/2}else{return f.getSize()}});metExploreD3.GraphNetwork.tick(b)},duplicateSideCompounds:function(b){if(b==undefined){b="viz"}var d=d3.select("#"+b).select("#D3viz");var c=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){d.selectAll("g.node").filter(function(h){return h.getIsSideCompound()&&h.getBiologicalType()=="metabolite"}).filter(function(h){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(h){metExploreD3.GraphNetwork.duplicateSideCompound(h,b);c.push(h)});metExploreD3.hideMask(a);c.forEach(function(h){metExploreD3.GraphNetwork.removeANode(h,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var g=_metExploreViz.getSessionsSet();var e=_metExploreViz.getSessionById(b);if(b!="viz"&&e.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var f in g){if(g[f].isLinked()&&g[f].getId()!="viz"){metExploreD3.deferFunction(function(){g[f].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var j=g[f].getForce();var h=_metExploreViz.getSessionById("viz");if(g[f]!=undefined){if(h.getDuplicatedNodesCount()>0){var j=g[f].getForce();g[f].setLinked(true);h.setLinked(true);metExploreD3.GraphNetwork.duplicateSideCompounds(g[f].getId());metExploreD3.GraphNetwork.looksLinked();if(g[f].isLinked()){metExploreD3.GraphNetwork.graphAlignment(g[f].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(g[f].getId());g[f].setLinked(true);h.setLinked(true)}}},100)}}}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompoundsById:function(c,b){var e=d3.select("#"+b).select("#D3viz");var d=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){e.selectAll("g.node").filter(function(f){return c.indexOf(f.getId())!=-1}).filter(function(f){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(f){metExploreD3.GraphNetwork.duplicateSideCompound(f,b);d.push(f)});metExploreD3.hideMask(a);d.forEach(function(f){metExploreD3.GraphNetwork.removeANode(f,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompoundsSelected:function(b){var d=d3.select("#"+b).select("#D3viz");var c=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){d.selectAll("g.node").filter(function(h){return h.isSelected()&&h.getBiologicalType()=="metabolite"}).filter(function(h){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(j){if(metExploreD3.getMetabolitesSet()!=undefined){var h=metExploreD3.getMetaboliteById(metExploreD3.getMetabolitesSet(),j.getId());h.set("sideCompound",true)}j.setIsSideCompound(true);metExploreD3.GraphNetwork.duplicateSideCompound(j,b);c.push(j)});metExploreD3.hideMask(a);c.forEach(function(h){metExploreD3.GraphNetwork.removeANode(h,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var g=_metExploreViz.getSessionsSet();var e=_metExploreViz.getSessionById(b);if(b!="viz"&&e.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var f in g){if(g[f].isLinked()&&g[f].getId()!="viz"){metExploreD3.deferFunction(function(){g[f].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var j=g[f].getForce();var h=_metExploreViz.getSessionById("viz");if(g[f]!=undefined){if(h.getDuplicatedNodesCount()>0){var j=g[f].getForce();g[f].setLinked(true);h.setLinked(true);metExploreD3.GraphNetwork.duplicateSideCompoundsSelected(g[f].getId());metExploreD3.GraphNetwork.looksLinked();if(g[f].isLinked()){metExploreD3.GraphNetwork.graphAlignment(g[f].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(g[f].getId());g[f].setLinked(true);h.setLinked(true)}}},100)}}}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateASideCompoundSelected:function(e,b){var d=d3.select("#"+b).select("#D3viz");var c=[];var a=metExploreD3.createLoadMask("Duplicate in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){d.selectAll("g.node").filter(function(j){if(e.querySelector("rect.metabolite")!=null){return j.getId()==e.querySelector("rect.metabolite").id&&j.isSelected()&&j.getBiologicalType()=="metabolite"}else{return false}}).filter(function(j){if(this.getAttribute("duplicated")==undefined){return true}else{return !this.getAttribute("duplicated")}}).each(function(k){if(metExploreD3.getMetabolitesSet()!=undefined){var j=metExploreD3.getMetaboliteById(metExploreD3.getMetabolitesSet(),k.getId());j.set("sideCompound",true)}k.setIsSideCompound(true);metExploreD3.GraphNetwork.duplicateSideCompound(k,b);c.push(k)});metExploreD3.hideMask(a);c.forEach(function(j){metExploreD3.GraphNetwork.removeANode(j,b)});if(_metExploreViz.isLinkedByTypeOfMetabolite()){metExploreD3.GraphLink.linkTypeOfMetabolite()}var h=_metExploreViz.getSessionsSet();var f=_metExploreViz.getSessionById(b);if(b!="viz"&&f.isLinked()){metExploreD3.fireEvent("graphPanel","afterDuplicate")}else{for(var g in h){if(h[g].isLinked()&&h[g].getId()!="viz"){metExploreD3.deferFunction(function(){h[g].setLinked(false);metExploreD3.GraphNetwork.looksLinked();var k=h[g].getForce();var j=_metExploreViz.getSessionById("viz");if(h[g]!=undefined){if(j.getDuplicatedNodesCount()>0){var k=h[g].getForce();h[g].setLinked(true);j.setLinked(true);metExploreD3.GraphNetwork.duplicateASideCompoundSelected(e,h[g].getId());metExploreD3.GraphNetwork.looksLinked();if(h[g].isLinked()){metExploreD3.GraphNetwork.graphAlignment(h[g].getId())}}else{metExploreD3.GraphNetwork.graphAlignment(h[g].getId());h[g].setLinked(true);j.setLinked(true)}}},100)}}}},0)}metExploreD3.GraphNetwork.initCentroids()},duplicateSideCompound:function(d,a){var e=_metExploreViz.getSessionById(a);var c=d3.select("#"+a).select("#D3viz");if(e!=undefined){if(e.isLinked()){var e=_metExploreViz.getSessionById("viz");if(e!=undefined){var b=e.getForce();if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"||metExploreD3.GraphNetwork.isAnimated("viz")==true){b.resume()}}}}else{var b=e.getForce();if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated(a)=="true"||metExploreD3.GraphNetwork.isAnimated(a)==true){b.resume()}}}}metExploreD3.GraphNetwork.duplicateANode(d,a);if(e!=undefined){if(b!=undefined){if(metExploreD3.GraphNetwork.isAnimated(a)=="true"||metExploreD3.GraphNetwork.isAnimated(a)==true){b.start()}}}metExploreD3.GraphNetwork.initCentroids()},removeSelectedNode:function(b){var e=_metExploreViz.getSessionById(b);var d=e.getForce();var c=e.getD3Data();var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var g=d3.select("#"+b).select("#D3viz");if(h!=undefined){if(h.isLinked()){var h=_metExploreViz.getSessionById("viz");if(h!=undefined){var f=h.getForce();if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){f.stop()}}}}else{var f=h.getForce();if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){f.stop()}}}}g.selectAll("g.node").filter(function(j){return j.isSelected()}).each(function(j){metExploreD3.GraphNetwork.removeANode(j,b)});metExploreD3.hideMask(a);metExploreD3.GraphNetwork.removeIsolatedNode(b);if(h!=undefined){if(f!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){f.start()}}}},100)}metExploreD3.GraphNetwork.initCentroids()},removeOnlyClickedNode:function(f,b){var e=_metExploreViz.getSessionById(b);var d=e.getForce();var c=e.getD3Data();var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var h=d3.select("#"+b).select("#D3viz");if(j!=undefined){if(j.isLinked()){var j=metExploreD3.getSessionById(sessionsStore,"viz");if(j!=undefined){var g=j.getForce();if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){g.resume()}}}}else{var g=j.getForce();if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){g.resume()}}}}metExploreD3.GraphNetwork.removeASelectedNode(f,b);metExploreD3.GraphNetwork.removeIsolatedNode(b);if(j!=undefined){if(g!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){g.start()}}}metExploreD3.hideMask(a)},100)}},removeASelectedNode:function(e,b){var f=_metExploreViz.getSessionById(b);var a=metExploreD3.createLoadMask("Remove in process...",b);if(a!=undefined){metExploreD3.showMask(a);var d=d3.select("#"+b).select("#D3viz");if(f!=undefined){if(f.isLinked()){var f=metExploreD3.getSessionById(sessionsStore,"viz");if(f!=undefined){var c=f.getForce();if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){c.resume()}}}}else{var c=f.getForce();if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated(b)=="true"){c.resume()}}}}metExploreD3.GraphNetwork.removeANode(e,b);if(f!=undefined){if(c!=undefined){if(metExploreD3.GraphNetwork.isAnimated("viz")=="true"){c.start()}}}metExploreD3.hideMask(a)}metExploreD3.GraphNetwork.initCentroids()},removeANode:function(h,b){var g=_metExploreViz.getSessionById(b);var f=g.getForce();var e=g.getD3Data();var a=[];var d=d3.select("#"+b).select("#D3viz");d.selectAll("path.link").filter(function(l){var j=l.source;var k=l.target;if(j==h||k==h){a.push(l)}return(j==h||k==h)}).remove();var c=d.selectAll("g.node");c.filter(function(j){return h==j}).transition().duration(1000).style("opacity",0).remove();setTimeout(function(){var l=g.getSelectedNodes();var j=l.indexOf(h.getId());if(j!=-1){l.splice(j,1)}g.groups.forEach(function(n){if(n.key==h.getCompartment()){var m=n.values.indexOf(h);if(m!=-1){n.values.splice(m,1)}if(n.values.length==0){m=g.groups.indexOf(n);if(m!=-1){g.groups.splice(m,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}h.getPathways().forEach(function(p){if(n.key==p){var o=n.values.indexOf(h);if(o!=-1){n.values.splice(o,1)}if(n.values.length==0){o=g.groups.indexOf(n);if(o!=-1){g.groups.splice(o,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}})});var j=f.nodes().indexOf(h);if(j!=-1){f.nodes().splice(j,1)}for(i=0;i<a.length;i++){var k=a[i];var j=f.links().indexOf(k);if(j!=-1){f.links().splice(j,1)}}},10)},removeIsolatedNode:function(b){var g=_metExploreViz.getSessionById(b);var d=g.getForce();var f=g.getD3Data();var h=[];var e=d3.select("#"+b).select("#D3viz");var j=[];var c=f.getNodes().map(function(k){return k.getId()});var a=false;e.selectAll("path.link").each(function(k){var n=k.source;var o=k.target;var l=c.indexOf(n.getId());if(l!=-1){c.splice(l,1)}var m=c.indexOf(o.getId());if(m!=-1){c.splice(m,1)}});e.selectAll("g.node").filter(function(k){return c.indexOf(k.getId())!=-1}).transition().duration(1000).style("opacity",0).remove();setTimeout(function(){for(i=0;i<h.length;i++){var l=h[i];g.groups.forEach(function(n){if(n.key==l.getCompartment()){var m=n.values.indexOf(l);if(m!=-1){n.values.splice(m,1)}if(n.values.length==0){m=g.groups.indexOf(n);if(m!=-1){g.groups.splice(m,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}l.getPathways().forEach(function(p){if(n.key==p){var o=n.values.indexOf(l);if(o!=-1){n.values.splice(o,1)}if(n.values.length==0){o=g.groups.indexOf(n);if(o!=-1){g.groups.splice(o,1);d3.select("#"+b).select("#D3viz").select("path#"+n.key).remove()}}}})});var k=d.nodes().indexOf(l);if(k!=-1){d.nodes().splice(k,1)}}for(i=0;i<h.length;i++){var l=h[i];var k=d.nodes().indexOf(l);if(k!=-1){d.nodes().splice(k,1)}}},10)},removeSideCompounds:function(){var a=d3.select("#viz").select("#D3viz");a.selectAll("g.node").filter(function(b){return b.getBiologicalType()=="metabolite"&&b.getIsSideCompound()}).each(function(b){metExploreD3.GraphNetwork.removeASelectedNode(b,"viz")});metExploreD3.GraphNetwork.removeIsolatedNode("viz");metExploreD3.GraphNetwork.initCentroids()},setAnimated:function(a,b){if(b){d3.select("#"+a).select("#D3viz").attr("animation","true");_metExploreViz.getSessionById(a).setAnimated(true)}else{d3.select("#"+a).select("#D3viz").attr("animation","false");_metExploreViz.getSessionById(a).setAnimated(false)}},isAnimated:function(a){return d3.select("#"+a).select("#D3viz").attr("animation")},selectAllNodes:function(a){return d3.select("#"+a).select("#D3viz").selectAll("g.node")},stopForce:function(b){var a=b.getForce();if(a!=undefined){a.stop();metExploreD3.GraphNetwork.setAnimated(b.getId(),false)}},loadSvg:function(g,l){var n=parseInt(metExploreD3.GraphPanel.getHeight(l));var j=parseInt(metExploreD3.GraphPanel.getWidth(l));var q=metExploreD3.getLinkStyle();var b=g.getForce();var s=metExploreD3.getScaleById(l);metExploreD3.GraphCaption.drawCaption();if(s==undefined){var f=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(t).y(d).scaleExtent([0.01,30]).on("zoom",function(u){var h=_metExploreViz.getSessionById(l);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){f.zoom(l)}});s.add({graphName:l,xScale:t,yScale:d,zoomScale:1,xScaleCompare:1,yScaleCompare:1,zoomScaleCompare:metExploreD3.GraphNetwork.zoomListener.scale(),zoom:metExploreD3.GraphNetwork.zoomListener})}else{var f=metExploreD3.GraphNetwork;var t=d3.scale.linear().domain([0,j]).range([0,j]);var d=d3.scale.linear().domain([n,0]).range([n,0]);metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(t).y(d).scaleExtent([0.01,30]).on("zoom",function(u){var h=_metExploreViz.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){f.zoom(this.parentNode.id)}});s.setScale(t,d,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener)}var m=d3.select("#"+l);m.svg=m.select("#D3viz").selectAll("*").remove();var p;var e=false;var c=d3.select("#"+l).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(t).y(d).on("brushstart",function(w){var u=d3.select("#"+l).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var v=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&u!="true"){if(v!=undefined){if(v.isLinked()){var x=_metExploreViz.getSessionById("viz");if(x!=undefined){var h=x.getForce();if(h!=undefined){h.stop()}}}else{var h=v.getForce();if(h!=undefined){h.stop()}}}e=true;d3.select("#"+l).select("#brush").classed("hide",false);d3.select("#"+l).select("#D3viz").on("mousedown.zoom",null);p=d3.select("#"+l).select("#graphComponent").selectAll("g.node");p.each(function(y){y.previouslySelected=y.isSelected()})}else{var h=v.getForce();if(h!=undefined){h.stop()}d3.select("#"+l).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&e){var B=d3.event.target.extent();if(B[1][0]-B[0][0]>20||B[1][1]-B[0][1]>20){var y;var B=d3.event.target.extent();var v=metExploreD3.getScaleById(l);var x=v.getZoomScale();var u=metExploreD3.createLoadMask("Selection in progress...",l);if(u!=undefined){metExploreD3.showMask(u);metExploreD3.deferFunction(function(){p.classed("selected",function(I){var H=v.getXScale();var G=v.getYScale();y=(H(B[0][0])<=H(I.x)&&H(I.x)<H(B[1][0]))&&(G(B[0][1])<=G(I.y)&&G(I.y)<G(B[1][1]));if((I.isSelected()==false&&y==true)||(I.isSelected()==true&&y==false&&!I.previouslySelected)){_MyThisGraphNode.selection(I,l)}return y});metExploreD3.hideMask(u);var E=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(E!=undefined){if(E.isLinked()){var F=_metExploreViz.getSessionById("viz");if(F!=undefined){var C=metExploreD3.GraphNetwork.isAnimated(F.getId());if(C=="true"){var D=F.getForce();if(D!=undefined){if((metExploreD3.GraphNetwork.isAnimated(F.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(F.getId())==null)){D.start()}}}}}else{var D=E.getForce();var C=metExploreD3.GraphNetwork.isAnimated(E.getId());if(C=="true"){var D=E.getForce();if(D!=undefined){if((metExploreD3.GraphNetwork.isAnimated(E.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(E.getId())==null)){D.start()}}}}}e=false},100)}}d3.event.target.clear();d3.select(this).call(d3.event.target);var v=metExploreD3.getScaleById(l);d3.select("#"+l).selectAll("#D3viz").style("cursor","default");d3.select("#"+l).selectAll("#D3viz").call(v.getZoom()).on("dblclick.zoom",null).on("mousedown",null)}else{var z=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(z!=undefined){if(z.isLinked()){var w=_metExploreViz.getSessionById("viz");if(w!=undefined){var A=metExploreD3.GraphNetwork.isAnimated(w.getId());if(A=="true"){var h=w.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(w.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(w.getId())==null)){h.start()}}}}}else{var h=z.getForce();var A=metExploreD3.GraphNetwork.isAnimated(z.getId());if(A=="true"){var h=z.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(z.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(z.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var v=metExploreD3.getScaleById(l);d3.select("#"+l).selectAll("#D3viz").style("cursor","default");d3.select("#"+l).selectAll("#D3viz").call(v.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));m.svg=d3.select("#"+l).select("#D3viz").call(metExploreD3.GraphNetwork.zoomListener).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");var a=_metExploreViz.getSessionById(l);if(a!=undefined){var b=a.getForce();if(b!=undefined){b.stop();metExploreD3.GraphNetwork.setAnimated(l,false)}if(a.isResizable()!=undefined){metExploreD3.GraphNetwork.task.cancel()}a.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){a.setResizable(false)})}var o=false;d3.select("#"+l).select("#D3viz").attr("animation",function(){if(o){return"true"}else{return"false"}}).append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",function(){if(o){return document.location.href.split("index.html")[0]+"resources/icons/pause.svg"}else{return document.location.href.split("index.html")[0]+"resources/icons/play.svg"}}).attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(j-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(j-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(j-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+l).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(j-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(j-160)+",10) scale(1)");d3.select("#"+l).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+l).on("mouseover",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var u=_metExploreViz.getSessionById(l);if(u.isActive()){var h=d3.select("#"+l).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+l).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+l).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});var a=_metExploreViz.getSessionById(l);var q=metExploreD3.getLinkStyle();var r=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.loadLink(l,a,q,r);metExploreD3.GraphNode.loadNode(l);var k=document.createElement("div");k.id="tooltip2";k.className="tooltip2";metExploreD3.GraphNetwork.looksLinked();if(a.isLinked()){metExploreD3.GraphNetwork.graphAlignment(l)}metExploreD3.GraphNetwork.tick(l)},loadSvgFromJSON:function(a){var k=parseInt(metExploreD3.GraphPanel.getHeight(a));var r=parseInt(metExploreD3.GraphPanel.getWidth(a));var j=metExploreD3.getLinkStyle();var d=d3.layout.force().friction(0.9).gravity(0.06).charge(-150).linkDistance(j.getSize()).size([r,k]);var p=metExploreD3.getSessionById(a);p.setActivity(true);p.setForce(d);if(a=="viz"){metExploreD3.GraphCaption.drawCaption()}var s=d3.scale.linear().domain([0,r]).range([0,r]);var f=d3.scale.linear().domain([k,0]).range([k,0]);if(metExploreD3.getScaleById(a)==undefined){var l=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(s).y(f).scaleExtent([0.01,30]).on("zoom",function(t){var h=metExploreD3.getSessionById(a);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){l.zoom(a)}});scale.add({graphName:a,xScale:s,yScale:f,zoomScale:1,xScaleCompare:1,yScaleCompare:1,zoomScaleCompare:metExploreD3.GraphNetwork.zoomListener.scale(),zoom:metExploreD3.GraphNetwork.zoomListener})}else{var l=metExploreD3.GraphNetwork;metExploreD3.GraphNetwork.zoomListener=d3.behavior.zoom().x(s).y(f).scaleExtent([0.01,30]).on("zoom",function(t){var h=metExploreD3.getSessionById(this.parentNode.id);if(d3.event.sourceEvent!=null){if(d3.event.sourceEvent.type=="wheel"){h.setResizable(false)}}if(h.isActive()){l.zoom(this.parentNode.id)}});scale.getStoreByGraphName(a).setScale(s,f,1,1,1,metExploreD3.GraphNetwork.zoomListener.scale(),metExploreD3.GraphNetwork.zoomListener)}var c=d3.select("#"+a);c.svg=c.select("#D3viz").selectAll("*").remove();var o;var e=false;var n=d3.select("#"+a).select("#D3viz").append("g").datum(function(){return{selected:false,previouslySelected:false}}).attr("id","brush").attr("class","brush").call(d3.svg.brush().x(s).y(f).on("brushstart",function(v){var t=d3.select("#"+a).select("#buttonHand").attr("scrollable");_MyThisGraphNode.activePanel=this.parentNode.parentNode.id;var u=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(d3.event.sourceEvent.button!=1&&t!="true"){if(u!=undefined){if(u.isLinked()){var w=_metExploreViz.getSessionById("viz");if(w!=undefined){var h=w.getForce();if(h!=undefined){h.stop()}}}else{var h=u.getForce();if(h!=undefined){h.stop()}}}e=true;d3.select("#"+a).select("#brush").classed("hide",false);d3.select("#"+a).select("#D3viz").on("mousedown.zoom",null);o=d3.select("#"+a).select("#graphComponent").selectAll("g.node");o.each(function(x){x.previouslySelected=x.isSelected()})}else{var h=u.getForce();if(h!=undefined){h.stop()}d3.select("#"+a).selectAll("#D3viz").style("cursor","all-scroll");d3.selectAll("#brush").classed("hide",true)}}).on("brushend",function(){if(d3.event.sourceEvent.button!=1&&e){var A=d3.event.target.extent();if(A[1][0]-A[0][0]>20||A[1][1]-A[0][1]>20){var x;var A=d3.event.target.extent();var u=metExploreD3.getScaleById(a);var w=u.getZoomScale();var t=metExploreD3.createLoadMask("Selection in progress...",a);if(t!=undefined){metExploreD3.showMask(t);metExploreD3.deferFunction(function(){o.classed("selected",function(H){var G=u.getXScale();var F=u.getYScale();x=(G(A[0][0])<=G(H.x)&&G(H.x)<G(A[1][0]))&&(F(A[0][1])<=F(H.y)&&F(H.y)<F(A[1][1]));if((H.isSelected()==false&&x==true)||(H.isSelected()==true&&x==false&&!H.previouslySelected)){_MyThisGraphNode.selection(H,a)}return x});metExploreD3.hideMask(t);var D=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(D!=undefined){if(D.isLinked()){var E=_metExploreViz.getSessionById("viz");if(E!=undefined){var B=metExploreD3.GraphNetwork.isAnimated(E.getId());if(B=="true"){var C=E.getForce();if(C!=undefined){if((metExploreD3.GraphNetwork.isAnimated(E.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(E.getId())==null)){C.start()}}}}}else{var C=D.getForce();var B=metExploreD3.GraphNetwork.isAnimated(D.getId());if(B=="true"){var C=D.getForce();if(C!=undefined){if((metExploreD3.GraphNetwork.isAnimated(D.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(D.getId())==null)){C.start()}}}}}e=false},100)}}d3.event.target.clear();d3.select(this).call(d3.event.target);var u=metExploreD3.getScaleById(a);d3.select("#"+a).selectAll("#D3viz").style("cursor","default");d3.select("#"+a).selectAll("#D3viz").call(u.getZoom()).on("dblclick.zoom",null).on("mousedown",null)}else{var y=_metExploreViz.getSessionById(_MyThisGraphNode.activePanel);if(y!=undefined){if(y.isLinked()){var v=_metExploreViz.getSessionById("viz");if(v!=undefined){var z=metExploreD3.GraphNetwork.isAnimated(v.getId());if(z=="true"){var h=v.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(v.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(v.getId())==null)){h.start()}}}}}else{var h=y.getForce();var z=metExploreD3.GraphNetwork.isAnimated(y.getId());if(z=="true"){var h=y.getForce();if(h!=undefined){if(d3.select(metExploreD3.GraphNetwork.isAnimated(y.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(y.getId())==null)){h.start()}}}}}}d3.event.target.clear();d3.select(this).call(d3.event.target);var u=metExploreD3.getScaleById(a);d3.select("#"+a).selectAll("#D3viz").style("cursor","default");d3.select("#"+a).selectAll("#D3viz").call(u.getZoom()).on("dblclick.zoom",null).on("mousedown",null);d3.event.target.extent();d3.selectAll("#brush").classed("hide",false)}));c.svg=d3.select("#"+a).select("#D3viz").call(metExploreD3.GraphNetwork.zoomListener).on("dblclick.zoom",null).attr("pointer-events","all").append("svg:g").attr("class","graphComponent").attr("id","graphComponent");var p=_metExploreViz.getSessionById(a);if(p!=undefined){var d=p.getForce();if(d!=undefined){d.stop();metExploreD3.GraphNetwork.setAnimated(a,false)}if(p.isResizable()!=undefined&&p.isResizable()!=false){metExploreD3.GraphNetwork.task.cancel()}p.setResizable(true);metExploreD3.GraphNetwork.task=metExploreD3.createDelayedTask(function(){p.setResizable(false)})}d3.select("#"+a).select("#D3viz").attr("animation","true").append("svg:g").attr("class","buttonAnim").attr("id","buttonAnim").on("click",metExploreD3.GraphNetwork.play).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/pause.svg").attr("width","50").attr("height","50").attr("transform","translate(10,10) scale(.5)");d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","whiteBlack").attr("id","whiteBlack").attr("x",(r-100)).attr("y",100).on("click",function(){if(d3.select("#"+a).style("-webkit-filter").search("grayscale")==-1&&d3.select("#"+a).style("filter").search("grayscale")==-1){d3.select("#"+a).style("filter","grayscale(100%)").style("-webkit-filter","grayscale(100%)")}else{d3.select("#"+a).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/blackWhite.png").attr("width","50").attr("height","50").attr("transform","translate("+(r-100)+",100) scale(0.5)");d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","invertColor").attr("id","invertColor").attr("x",(r-100)).attr("y",150).on("click",function(){if(d3.select("#"+a).style("-webkit-filter").search("invert")==-1&&d3.select("#"+a).style("filter").search("invert")==-1){d3.select("#"+a).style("filter","invert(100%)").style("-webkit-filter","invert(100%)")}else{d3.select("#"+a).style("filter","").style("-webkit-filter","")}}).style("cursor","hand").style("visibility","hidden").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/invertColor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(r-100)+",150) scale(0.5)");d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","buttonZoomIn").attr("id","buttonZoomIn").attr("x",(r-60)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomIn).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomin.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(r-60)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","buttonZoomOut").attr("id","buttonZoomOut").attr("x",(r-110)).attr("y",10).on("click",metExploreD3.GraphNetwork.zoomOut).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/zoomout.svg").attr("width","50").attr("height","50").style("opacity",0.2).attr("transform","translate("+(r-110)+",10) scale(1)").on("mouseover",function(h){d3.select(this).transition().duration(500).style("opacity",1)}).on("mouseout",function(h){d3.select(this).transition().duration(500).style("opacity",0.2)});d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","buttonHand").attr("id","buttonHand").attr("x",(r-160)).attr("y",10).attr("scrollable","false").on("click",metExploreD3.GraphNetwork.moveGraph).style("opacity",1).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/handcursor.svg").attr("width","50").attr("height","50").attr("transform","translate("+(r-160)+",10) scale(1)");d3.select("#"+a).select("#D3viz").select("buttonHand").style("opacity",0);d3.select("#"+a).on("mouseover",function(){d3.select("#"+a).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",1);d3.select("#"+a).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",1);var t=_metExploreViz.getSessionById(a);if(t.isActive()){var h=d3.select("#"+a).select("#buttonHand").attr("scrollable");if(h=="false"){d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0.2)}else{d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",1)}}}).on("mouseout",function(){d3.select("#"+a).select("#D3viz").select("#buttonZoomOut").transition().duration(500).style("opacity",0);d3.select("#"+a).select("#D3viz").select("#buttonZoomIn").transition().duration(500).style("opacity",0);d3.select("#"+a).select("#D3viz").select("#buttonHand").transition().duration(500).style("opacity",0)});metExploreD3.GraphNetwork.setAnimated(a,true);var p=_metExploreViz.getSessionById(a);var j=metExploreD3.getLinkStyle();var m=metExploreD3.getMetaboliteStyle();metExploreD3.GraphLink.refreshLink(a,p,j,m);metExploreD3.GraphNode.refreshNode(a);var q=document.createElement("div");q.id="tooltip2";q.className="tooltip2";document.getElementById("viz").appendChild(q);var b=d3.select(l).attr("isLink");d3.select(l).select("image").remove();d3.select(l).append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/link.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)");p.setLinked(false);if(a!="viz"){d3.select("#"+a).select("#D3viz").append("svg:g").attr("class","buttonLink").attr("id","buttonLink").attr("isLink","false").on("click",metExploreD3.GraphNetwork.setLink).style("cursor","hand").append("image").attr("xlink:href",document.location.href.split("index.html")[0]+"resources/icons/unlink.svg").attr("width","50").attr("height","50").attr("transform","translate(10,50) scale(.5)")}else{metExploreD3.GraphNetwork.looksLinked();if(p.isLinked()){metExploreD3.GraphNetwork.graphAlignment(a)}}var p=metExploreD3.getSessionById(a);var g=p.getD3Data();var d=p.getForce();d.nodes(g.getNodes()).links(g.getLinks()).on("tick",function(){if(d.alpha()>=0.005){setTimeout(metExploreD3.GraphNetwork.tick(a),0)}}).start();p.setForce(d)}};