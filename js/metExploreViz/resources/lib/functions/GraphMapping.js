/* 
This file is part of MetExploreViz 
 
Copyright (c) 2016 INRA 
 
Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
GNU General Public License Usage 
This file may be used under the terms of the GNU General Public License version 3.0 as 
published by the Free Software Foundation and appearing in the file LICENSE included in the 
packaging of this file. 
 
Please review the following information to ensure the GNU General Public License version 3.0 
requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 
If you are unsure which license is appropriate for your use, please contact us 
at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
Version: 1 Build date: 2016-04-13 9:34:37 
*/ 
metExploreD3.GraphMapping={mapNodeDataFile:function(b,d){var e=_metExploreViz.getSessionById("viz");var c=e.getForce();c.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var l=e.getD3Data();var m=b.getConditions();var f=d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node");var h=undefined;switch(b.getTargetLabel()){case"reactionDBIdentifier":for(var g=m.length-1;g>=0;g--){d.forEach(function(o){var n=new MappingData(o[b.getTargetLabel()],b.getName(),m[g],o[m[g]]);b.addMap(n);h=l.getNodeByDbIdentifier(o[b.getTargetLabel()]);if(h!=undefined){var i=new MappingData(h,b.getName(),m[g],o[m[g]]);h.addMappingData(i)}})}break;case"reactionId":for(var g=m.length-1;g>=0;g--){d.forEach(function(o){var n=new MappingData(o[b.getTargetLabel()],b.getName(),m[g],o[m[g]]);b.addMap(n);h=l.getNodeByDbIdentifier(o[b.getTargetLabel()]);if(h!=undefined){var i=new MappingData(h,b.getName(),m[g],o[m[g]]);h.addMappingData(i)}})}break;case"metaboliteId":for(var g=m.length-1;g>=0;g--){d.forEach(function(o){var n=new MappingData(o[b.getTargetLabel()],b.getName(),m[g],o[m[g]]);b.addMap(n);h=l.getNodeByDbIdentifier(o[b.getTargetLabel()]);if(h!=undefined){var i=new MappingData(h,b.getName(),m[g],o[m[g]]);h.addMappingData(i)}})}break;case"metaboliteDBIdentifier":for(var g=m.length-1;g>=0;g--){d.forEach(function(o){var n=new MappingData(o[b.getTargetLabel()],b.getName(),m[g],o[m[g]]);b.addMap(n);h=l.getNodeByDbIdentifier(o[b.getTargetLabel()]);if(h!=undefined){var i=new MappingData(h,b.getName(),m[g],o[m[g]]);h.addMappingData(i)}})}break;case"inchi":for(var g=m.length-1;g>=0;g--){d.forEach(function(n){var i=new MappingData(n[b.getTargetLabel()],b.getName(),m[g],n[m[g]]);b.addMap(i);h=l.getNodeByMappedInchi(n[b.getTargetLabel()]);if(h!=undefined){h.forEach(function(p){var o=new MappingData(p,b.getName(),m[g],n[m[g]]);p.addMappingData(o)})}})}break;default:metExploreD3.displayMessage("Warning",'The type of node "'+b.getTargetLabel()+"\" isn't know.")}metExploreD3.hideMask(a);var k=metExploreD3.GraphNetwork.isAnimated("viz");if(k=="true"){var j=e.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){j.resume()}}},1000)}},mapNodeData:function(c,b){var e=_metExploreViz.getSessionById("viz");var d=e.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var l=e.getD3Data();var m=c.getConditions();var f=d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node");var h=undefined;switch(c.getTargetLabel()){case"reactionDBIdentifier":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeByDbIdentifier(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"reactionId":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeById(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"metaboliteId":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeById(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"metaboliteDBIdentifier":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeByDbIdentifier(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+c.getTargetLabel()+"\" isn't know.")}metExploreD3.hideMask(a);var k=metExploreD3.GraphNetwork.isAnimated("viz");if(k=="true"){var j=e.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){j.resume()}}},1000)}},mapNodes:function(b,a){metExploreD3.onloadMapping(b,function(){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(e){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove();var c=metExploreD3.createLoadMask("Mapping in progress...","viz");var d=_metExploreViz.getMappingByName(b);if(c!=undefined){metExploreD3.showMask(c);setTimeout(function(){var h=_metExploreViz.getSessionById("viz");var f=h.getForce();f.stop();var g=d.getConditions();g.forEach(function(i){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(j){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return true}else{return false}}).each(function(l){if(l.getBiologicalType()=="reaction"){if(l.getMappingDataByNameAndCond(d.getName(),i)!=null){var j=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(l,"viz",j);d3.select(this).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".reaction").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".reaction").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".reaction").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".reaction").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");h.addSelectedNode(l.getId())}}else{if(l.getBiologicalType()=="metabolite"){var m=d3.select(this).select(".metabolite").attr("identifier");if(l.getMappingDataByNameAndCond(d.getName(),i)!=null){var k=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(l,"viz",k);d3.select(this).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".metabolite").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".metabolite").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".metabolite").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".metabolite").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");h.addSelectedNode(l.getId())}}}}).each(function(l){if(d3.select(this).select(".stroke")[0][0]==null){if(l.getBiologicalType()=="reaction"){if(l.getMappingDataByNameAndCond(d.getName(),i)!=null){var j=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(l,"viz",j);d3.select(this).insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".reaction").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".reaction").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".reaction").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".reaction").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");h.addSelectedNode(l.getId());return true}else{return false}}else{if(l.getBiologicalType()=="metabolite"){var m=d3.select(this).select(".metabolite").attr("identifier");if(l.getMappingDataByNameAndCond(d.getName(),i)!=null){var k=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(l,"viz",k);d3.select(this).insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".metabolite").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".metabolite").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".metabolite").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".metabolite").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");h.addSelectedNode(l.getId());return true}else{return false}}}}})});metExploreD3.hideMask(c);if(a!=undefined){a()}var e=metExploreD3.GraphNetwork.isAnimated("viz");if(e=="true"){var h=_metExploreViz.getSessionById("viz");var f=h.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){f.resume()}}},1000)}})},reloadMapping:function(b){var d=_metExploreViz.getSessionById("viz");var c=d.getForce();c.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var h=d.getD3Data();var i=b.getConditions();var e=undefined;switch(b.getTargetLabel()){case"reactionDBIdentifier":b.getData().forEach(function(l){var j=h.getNodeByDbIdentifier(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"reactionId":b.getData().forEach(function(l){var j=h.getNodeById(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"metaboliteId":b.getData().forEach(function(l){var j=h.getNodeById(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"metaboliteDBIdentifier":b.getData().forEach(function(l){var j=h.getNodeByDbIdentifier(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+b.getTargetLabel()+"\" isn't know.")}metExploreD3.hideMask(a);var g=metExploreD3.GraphNetwork.isAnimated("viz");if(g=="true"){var f=d.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){f.resume()}}},1000)}},graphMappingDiscreteData:function(c,a,b){metExploreD3.onloadMapping(c,function(){var e=_metExploreViz.getMappingByName(c);var d=metExploreD3.createLoadMask("Mapping in progress...","viz");if(d!=undefined){metExploreD3.showMask(d);setTimeout(function(){var s=_metExploreViz.getSessionById("viz");var j=s.getForce();j.stop();var t=e.getConditions();var h=s.getD3Data().getNodes();var w=[];var k=d3.select("#viz").select("#D3viz");k.selectAll("g.node").filter(function(i){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).selectAll("rect.stroke").remove();t.forEach(function(i){h.forEach(function(z){var A=z.getMappingDataByNameAndCond(e.getName(),i);if(A!=null){var y=false;var x=A.getMapValue().valueOf();w.forEach(function(B){if(B.valueOf()==x.valueOf()){y=true}});if(!y){w.push(x)}}})});function f(x,i){if(parseFloat(x)<parseFloat(i)){return -1}if(parseFloat(x)>parseFloat(i)){return 1}return 0}function q(x,i){if(x<i){return -1}if(x>i){return 1}return 0}var r=[];var v=[];w.forEach(function(i){if(isNaN(i)){v.push(i)}else{r.push(i)}});r.sort(f);v.sort(q);w=r.concat(v);if(w.length==undefined){w.length=0}center=128;width=127;frequency=Math.PI*2*0.95/w.length;var p=top;var g=s.getColorMappingsSet();s.resetColorMapping();for(var o=0;o<w.length;o++){var l=Math.sin(frequency*o+2+w.length)*width+center;var n=Math.sin(frequency*o+0+w.length)*width+center;var u=Math.sin(frequency*o+4+w.length)*width+center;color=metExploreD3.GraphUtils.RGB2Color(l,n,u);s.addColorMapping(w[o],color);metExploreD3.GraphMapping.fixMappingColorOnNodeData(color,w[o],a,e.getName())}metExploreD3.hideMask(d);if(b!=undefined){b()}if(w.length!=0){metExploreD3.fireEventArg("selectConditionForm","afterDiscreteMapping","discrete")}else{metExploreD3.displayMessage("Warning","No mapped node on network.")}var m=metExploreD3.GraphNetwork.isAnimated("viz");if(m=="true"){var s=_metExploreViz.getSessionById("viz");var j=s.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){j.resume()}}},1000)}})},fixMappingColorOnNodeData:function(a,e,c,g){var d=d3.select("#viz").select("#D3viz");var f=_metExploreViz.getSessionById("viz");var b=a;d.selectAll("g.node").filter(function(k){if(k.getBiologicalType()=="reaction"){if(k.getMappingDatasLength()==0){return false}else{var j=k.getMappingDataByNameAndCond(g,c);if(j!=null){if(j.getMapValue()==e){var h=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(k,"viz",h);f.addSelectedNode(k.getId());return true}else{return false}}else{return false}}}else{if(k.getBiologicalType()=="metabolite"){if(k.getMappingDatasLength()==0){return false}else{var j=k.getMappingDataByNameAndCond(g,c);if(j!=null){if(j.getMapValue()==e){var i=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(k,"viz",i);f.addSelectedNode(k.getId());return true}else{return false}}else{return false}}}}}).transition().duration(3000).attr("mapped",a).style("fill",a).each(function(i){if(i.getBiologicalType()=="reaction"){var h=metExploreD3.GraphUtils.chooseTextColor(b);d3.select(this).select("text").style("fill",h)}})},graphMappingContinuousData:function(d,a,e,c,b){metExploreD3.onloadMapping(d,function(){var g=_metExploreViz.getMappingByName(d);var f=metExploreD3.createLoadMask("Mapping in progress...","viz");if(f!=undefined){metExploreD3.showMask(f);setTimeout(function(){var t=_metExploreViz.getGeneralStyle();var k=d3.select("#viz").select("#D3viz");var s=_metExploreViz.getSessionById("viz");var i=_metExploreViz.getSessionById("viz").getD3Data().getNodes();var u=g.getConditions();var o=undefined;var v=undefined;var w=g.getName();var r='{"mapping":[';var q=metExploreD3.getMetaboliteStyle();var m=metExploreD3.getReactionStyle();k.selectAll("g.node").filter(function(x){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).selectAll("rect.stroke").remove();u.forEach(function(x){r+='\n{"'+x+'":[';i.forEach(function(z){var A=z.getMappingDataByNameAndCond(w,x);if(A!=null){r+="\n{";var y=A.getMapValue();r+='"node" : "'+z.getName();r+='", "value" : "'+y;if(!isNaN(y)){if(o==undefined){v=parseFloat(y);o=parseFloat(y)}else{if(v>parseFloat(y)){v=parseFloat(y)}if(o<parseFloat(y)){o=parseFloat(y)}}}r+='"},\n'}});r+="]}\n"});r+="]}\n";if(e==undefined){e=t.getColorMinMappingContinuous()}if(c==undefined){c=t.getColorMaxMappingContinuous()}var k=d3.select("#viz").select("#D3viz");var p=d3.scale.linear().domain([parseFloat(v),parseFloat(o)]).range([1,3]);var h=s.getColorMappingsSet();s.resetColorMapping();var n=d3.scale.linear().domain([parseFloat(v),parseFloat(o)]).range([e,c]);if(v==o){s.addColorMapping(o,n(parseFloat(o)))}else{s.addColorMapping(o,n(parseFloat(o)));s.addColorMapping(v,n(parseFloat(v)))}k.selectAll("g.node").each(function(A){if(A.getMappingDatasLength()!=0){if(A.getBiologicalType()=="reaction"){var z=A.getMappingDataByNameAndCond(w,a);if(z!=null){if(!isNaN(z.getMapValue())){_MyThisGraphNode.addText(A,"viz",m);d3.select(this).transition().duration(2000).attr("transform","translate("+A.x+", "+A.y+") scale("+p(parseFloat(z.getMapValue()))+")").attr("mapped",n(parseFloat(parseFloat(z.getMapValue())))).style("fill",n(parseFloat(z.getMapValue())));var x=metExploreD3.GraphUtils.chooseTextColor(n(parseFloat(z.getMapValue())));d3.select(this).select("text").style("fill",x);s.addSelectedNode(A.getId())}}}else{var z=A.getMappingDataByNameAndCond(w,a);if(z!=null){if(!isNaN(z.getMapValue())){var y=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(A,"viz",y);d3.select(this).transition().duration(2000).attr("transform","translate("+A.x+", "+A.y+") scale("+p(parseFloat(z.getMapValue()))+")").attr("mapped",n(parseFloat(parseFloat(z.getMapValue())))).style("fill",n(parseFloat(z.getMapValue())));s.addSelectedNode(A.getId())}}}}});metExploreD3.hideMask(f);if(v!=undefined){metExploreD3.fireEventArg("selectConditionForm","afterContinuousMapping","continuous")}else{metExploreD3.displayMessage("Warning","No mapped node on network.")}if(b!=undefined){b()}var l=metExploreD3.GraphNetwork.isAnimated("viz");if(l=="true"){var s=_metExploreViz.getSessionById("viz");var j=s.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){j.resume()}}},1000)}})},graphMappingBinary:function(b){var c=metExploreD3.getSessionsSet();var e=metExploreD3.getSessionById(c,"viz");var d=e.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){metExploreD3.GraphMapping.fixMappingColorOnNode("#056da1",1,b);metExploreD3.hideMask(a);var h=metExploreD3.GraphNetwork.isAnimated("viz");if(h=="true"){var f=metExploreD3.getSessionsSet();var i=metExploreD3.getSessionById(f,"viz");var g=i.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){g.resume()}}},1000)}},fixMappingColorOnNode:function(b,e,c){var d=d3.select("#viz").select("#D3viz");var f=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();d.selectAll("g.node").filter(function(i){if(i.getBiologicalType()=="reaction"){if(metExploreD3.getReactionById(a,i.getId()).get("mapped")==undefined){return false}else{if((metExploreD3.getReactionById(a,i.getId()).get("mapped")!=0)&&metExploreD3.getReactionById(a,i.getId()).get(c)==e){var j=metExploreD3.getSessionsSet();var g=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(i,"viz",g,j);return true}else{return false}}}else{if(i.getBiologicalType()=="metabolite"&&!i.isSideCompound()){if(metExploreD3.getMetaboliteById(f,i.getId())==null){return false}if(metExploreD3.getMetaboliteById(f,i.getId()).get("mapped")==undefined){return false}else{if((metExploreD3.getMetaboliteById(f,i.getId()).get("mapped")!=0)&&metExploreD3.getMetaboliteById(f,i.getId()).get(c)==e){var j=metExploreD3.getSessionsSet();var h=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(i,"viz",h,j);return true}else{return false}}}}}).transition().duration(4000).attr("mapped",b).style("fill",b)},setDiscreteMappingColor:function(b,e,c,g){var f=_metExploreViz.getSessionById("viz");var d=f.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var i=d3.select("#viz").select("#D3viz");var j=f.getColorMappingsSet();var h=f.getColorMappingById(e);h.setValue(b);metExploreD3.GraphMapping.fixMappingColorOnNodeData(b,e,c,g);metExploreD3.hideMask(a)},1000)}},setContinuousMappingColor:function(f,i,j,e){var h=_metExploreViz.getSessionById("viz");var b=h.getForce();b.stop();var d=metExploreD3.createLoadMask("Mapping in progress...","viz");if(d!=undefined){metExploreD3.showMask(d);var c=d3.select("#viz").select("#D3viz");var a=h.getColorMappingsSet();var g=h.getColorMappingById(i);g.setValue(f);metExploreD3.hideMask(d)}},removeGraphMapping:function(b){var e=_metExploreViz.getSessionById("viz");var c=d3.select("#viz").select("#D3viz");var d=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();c.selectAll("g.node").filter(function(f){if(f.getBiologicalType()=="reaction"){if(metExploreD3.getReactionById(a,f.getId()).get("mapped")==undefined){return false}else{return metExploreD3.getReactionById(a,f.getId()).get("mapped")!=0}}else{if(f.getBiologicalType()=="metabolite"){if(metExploreD3.getMetaboliteById(d,f.getId()).get("mapped")==undefined){return false}else{return metExploreD3.getMetaboliteById(d,f.getId()).get("mapped")!=0}}}}).transition().duration(4000).attr("transform",function(f){return"translate("+f.x+", "+f.y+") scale(1)"}).style("fill","white");c.selectAll("g.node").filter(function(f){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove()},removeGraphMappingData:function(a){var c=_metExploreViz.getSessionById("viz");var b=d3.select("#viz").select("#D3viz");b.selectAll("g.node").transition().duration(4000).attr("transform",function(e){return"translate("+e.x+", "+e.y+") scale(1)"}).style("fill","white").each(function(d){if(d.getBiologicalType()=="reaction"){if(d.isSelected()){d3.select(this).select("text").transition().duration(4000).style("fill","white")}else{d3.select(this).select("text").transition().duration(4000).style("fill","black")}}});b.selectAll("g.node").filter(function(e){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove()},launchAfterMappingFunction:function(b,d){var a=_metExploreViz.getMappingByName(b);if(a!==null){d(a);return}var c=this;setTimeout(function(){c.launchAfterMappingFunction(b,d)},100)},onloadMapping:function(a,b){this.launchAfterMappingFunction(a,b)},removeMappingData:function(a){this.onloadMapping(a.get("title"),function(b){metExploreD3.fireEventArg("selectConditionForm","removeMapping",b)})},loadDataFromJSON:function(b){var d=_metExploreViz.getSessionById("viz");var c=d.getForce();c.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var g=Ext.decode(b);var f=[];g.mappings.forEach(function(j){f.push(j.name)});var e=new Mapping(g.name,f,g.targetLabel);_metExploreViz.addMapping(e);metExploreD3.GraphMapping.generateMapping(e,g.mappings);metExploreD3.hideMask(a);metExploreD3.fireEventArg("selectMappingVisu","jsonmapping",e);var i=metExploreD3.GraphNetwork.isAnimated("viz");if(i=="true"){var h=d.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){h.resume()}}},1000)}},loadDataTSV:function(a){d3.tsv(a,function(f){var e=a.split("/");var h=a.split("/")[e.length-1];var d=Object.keys(f[0])[0];var g=Object.keys(f[0]).indexOf(d);var c=Object.keys(f[0]);if(g>-1){c.splice(g,1)}var i=[];var b=new Mapping(h,c,d,i);_metExploreViz.addMapping(b);metExploreD3.GraphMapping.mapNodeDataFile(b,f);metExploreD3.fireEventArg("selectMappingVisu","jsonmapping",b)})},generateMapping:function(a,b){var d=_metExploreViz.getSessionById("viz");var c=d.getD3Data();switch(a.getTargetLabel()){case"reactionDBIdentifier":if(!(b.length==1&&b[0].name=="undefined")){b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeByDbIdentifier(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})})}else{b[0].data.forEach(function(g){var h=new MappingData(g.node,a.getName(),b[0].name,g.value);a.addMap(h);var e=c.getNodeByDbIdentifier(g.node);if(e!=undefined){var f=new MappingData(e,a.getName(),b[0].name,g.value);e.addMappingData(f)}})}break;case"metaboliteDBIdentifier":b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeByDbIdentifier(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})});break;case"reactionId":if(!(b.length==1&&b[0].name=="undefined")){b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeById(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})})}else{b[0].data.forEach(function(g){var h=new MappingData(g.node,a.getName(),b[0].name,g.value);a.addMap(h);var e=c.getNodeById(g.node);if(e!=undefined){var f=new MappingData(e,a.getName(),b[0].name,g.value);e.addMappingData(f)}})}break;case"metaboliteId":b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeById(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);if(h.inchi!=undefined){f.mappedInchi=h.inchi}f.addMappingData(g)}})});break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+a.getTargetLabel()+"\" isn't know.")}}};