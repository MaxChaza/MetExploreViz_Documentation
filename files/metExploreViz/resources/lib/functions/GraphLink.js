/* 
This file is part of MetExploreViz 
 
Copyright (c) 2016 INRA 
 
Contact: http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
GNU General Public License Usage 
This file may be used under the terms of the GNU General Public License version 3.0 as 
published by the Free Software Foundation and appearing in the file LICENSE included in the 
packaging of this file. 
 
Please review the following information to ensure the GNU General Public License version 3.0 
requirements will be met: http://www.gnu.org/copyleft/gpl.html. 
 
If you are unsure which license is appropriate for your use, please contact us 
at http://metexplore.toulouse.inra.fr/metexploreViz/doc/contact 
 
Version: 1 Build date: 2016-04-13 9:34:37 
*/ 
metExploreD3.GraphLink={link:"",panelParent:"",delayedInitialisation:function(a){metExploreD3.GraphLink.panelParent=a},funcPathForFlux2:function(g,b,h){var a,f,k;function e(l,p){var r=metExploreD3.getMetaboliteStyle();var n=metExploreD3.getReactionStyle();var q=Math.sqrt(Math.pow(p.x-l.x,2)+Math.pow(p.y-l.y,2));var o=(p.x-l.x);var m=(p.y-l.y);var t=o/Math.abs(o);var s=m/Math.abs(m);if(h=="linkRev"){k=j(l,p)}else{k=j(p,l)}return k}function j(y,F){var E=metExploreD3.getMetaboliteStyle();var D=metExploreD3.getReactionStyle();var C=Math.sqrt(Math.pow(F.x-y.x,2)+Math.pow(F.y-y.y,2));var q=(F.x-y.x);var p=(F.y-y.y);var x=q/Math.abs(q);var w=p/Math.abs(p);if(y.getBiologicalType()=="metabolite"){var B=(Math.abs(C)*D.getWidth()/2)/Math.abs(q);var n=(Math.abs(C)*D.getHeight()/2)/Math.abs(p);var s=(B<n)?rT=B:rt=n}else{var B=(Math.abs(C)*E.getWidth()/2)/Math.abs(q);var n=(Math.abs(C)*E.getHeight()/2)/Math.abs(p);var s=(B<n)?rT=B:rt=n}var z=y.x+q*((C-s)/C);var l=y.y+p*((C-s)/C);var r=5;var m=y.x+q*((C-s-r)/C);var u=y.y+p*((C-s-r)/C);var v=m+p*(3/C);var A=u-q*(3/C);var o=m+p*(2/C);var t=u-q*(2/C);return"M"+y.x+","+y.y+"L"+z+","+l+"L"+v+","+A+"L"+o+","+t+"L"+y.x+","+y.y+"Z"}if(g.getSource().x==undefined){var d=_metExploreViz.getSessionById(b).getD3Data();var c=d.getNodes();a=c[g.getSource()];f=c[g.getTarget()];if(a.x!=undefined&&a.y!=undefined&&f.x!=undefined&&f.y!=undefined){if(a.getReactionReversibility()||f.getReactionReversibility()){k=e(a,f)}else{k=j(a,f)}}else{k="M0,0L0,0Z"}}else{a=g.getSource();f=g.getTarget();if(a.x!=undefined&&a.y!=undefined&&f.x!=undefined&&f.y!=undefined){if(a.getReactionReversibility()||f.getReactionReversibility()){k=e(a,f)}else{k=j(a,f)}}else{k="M0,0L0,0Z"}}return k},funcPathForFlux:function(f,k,c){var o,u,m,a;var g=_metExploreViz.getSessionById("viz").getActiveMapping();var h=_metExploreViz.getMappingByName(_metExploreViz.getSessionById("viz").getActiveMapping());var e=h.getConditions();var v,t;var l=undefined;var q=undefined;var j=_metExploreViz.getSessionById("viz").getColorMappingsSet();j.forEach(function(w){if(q==undefined|w.getName()>q){q=w.getName()}});var s=d3.scale.linear().domain([-q,0,0,q]).range([-7,-1,1,7]);function r(w,A){var C=metExploreD3.getMetaboliteStyle();var y=metExploreD3.getReactionStyle();v=a.getMappingDataByNameAndCond(g,e[0]);t=a.getMappingDataByNameAndCond(g,e[1]);var B=Math.sqrt(Math.pow(A.x-w.x,2)+Math.pow(A.y-w.y,2));var z=(A.x-w.x);var x=(A.y-w.y);var E=z/Math.abs(z);var D=x/Math.abs(x);if(c=="linkRev"){if(t==null){var F=0}else{if(isNaN(t.getMapValue())){var F=0}else{var F=s(t.getMapValue())}}if(F==-1||F==1){F=0}if(F<0){m=d(A,w,F)}else{m=p(w,A,F)}}else{if(v==null){var F=0}else{if(isNaN(v.getMapValue())){var F=0}else{var F=s(v.getMapValue())}}if(F==-1||F==1){F=0}if(F<0){m=p(A,w,F)}else{m=d(w,A,F)}}return m}function p(N,ab,O){var Z=metExploreD3.getMetaboliteStyle();var X=metExploreD3.getReactionStyle();var W=Math.sqrt(Math.pow(ab.x-N.x,2)+Math.pow(ab.y-N.y,2));var C=(ab.x-N.x);var B=(ab.y-N.y);var M=C/Math.abs(C);var L=B/Math.abs(B);if(N.getBiologicalType()=="metabolite"){var U=(Math.abs(W)*X.getWidth()/2)/Math.abs(C);var z=(Math.abs(W)*X.getHeight()/2)/Math.abs(B);var G=(U<z)?rT=U:rt=z}else{var U=(Math.abs(W)*Z.getWidth()/2)/Math.abs(C);var z=(Math.abs(W)*Z.getHeight()/2)/Math.abs(B);var G=(U<z)?rT=U:rt=z}var P=N.x+C*((W-G)/W);var x=N.y+B*((W-G)/W);var D=2*Math.abs(O);if(D<3){D=3}var y=N.x+C*((W-G-D)/W);var I=N.y+B*((W-G-D)/W);var E=2.5*Math.abs(O);var V=(2.5*Math.abs(O))*1/2;if(E<2){E=2}var K=y+B*(-E/W);var R=I-C*(-E/W);var A=y+B*(-V/W);var H=I-C*(-V/W);var Y=Math.abs(O);var J=N.x+C*(Y/W);var w=N.y+B*(Y/W);var T=J+B*(-V/W);var Q=w-C*(-V/W);var aa=Math.sqrt(Math.pow(P-N.x,2)+Math.pow(x-N.y,2));if(D+Y>aa){T=A;Q=H}var F=N.x;var S=N.y;if(c=="linkRev"){return"M"+(F+B*(-2/W))+","+(S-C*(-2/W))+"L"+(P+B*(-2/W))+","+(x-C*(-2/W))+"L"+(K+B*(-2/W))+","+(R-C*(-2/W))+"L"+(A+B*(-2/W))+","+(H-C*(-2/W))+"L"+(T+B*(-2/W))+","+(Q-C*(-2/W))+"L"+(F+B*(-2/W))+","+(S-C*(-2/W))+"Z"}else{return"M"+F+","+S+"L"+P+","+x+"L"+K+","+R+"L"+A+","+H+"L"+T+","+Q+"L"+N.x+","+N.y+"Z"}}function d(N,ab,O){var Z=metExploreD3.getMetaboliteStyle();var X=metExploreD3.getReactionStyle();var W=Math.sqrt(Math.pow(ab.x-N.x,2)+Math.pow(ab.y-N.y,2));var C=(ab.x-N.x);var B=(ab.y-N.y);var M=C/Math.abs(C);var L=B/Math.abs(B);if(N.getBiologicalType()=="metabolite"){var U=(Math.abs(W)*X.getWidth()/2)/Math.abs(C);var z=(Math.abs(W)*X.getHeight()/2)/Math.abs(B);var G=(U<z)?rT=U:rt=z}else{var U=(Math.abs(W)*Z.getWidth()/2)/Math.abs(C);var z=(Math.abs(W)*Z.getHeight()/2)/Math.abs(B);var G=(U<z)?rT=U:rt=z}var P=N.x+C*((W-G)/W);var x=N.y+B*((W-G)/W);var D=2*Math.abs(O);if(D<3){D=3}var y=N.x+C*((W-G-D)/W);var I=N.y+B*((W-G-D)/W);var E=2.5*Math.abs(O);var V=(2.5*Math.abs(O))*1/2;if(E<2){E=2}var K=y+B*(E/W);var R=I-C*(E/W);var A=y+B*(V/W);var H=I-C*(V/W);var Y=Math.abs(O);var J=N.x+C*(Y/W);var w=N.y+B*(Y/W);var T=J+B*(V/W);var Q=w-C*(V/W);var aa=Math.sqrt(Math.pow(P-N.x,2)+Math.pow(x-N.y,2));if(D+Y>aa){T=A;Q=H}var F=N.x;var S=N.y;if(c=="linkRev"){return"M"+(F+B*(2/W))+","+(S-C*(2/W))+"L"+(P+B*(2/W))+","+(x-C*(2/W))+"L"+(K+B*(2/W))+","+(R-C*(2/W))+"L"+(A+B*(2/W))+","+(H-C*(2/W))+"L"+(T+B*(2/W))+","+(Q-C*(2/W))+"L"+(F+B*(2/W))+","+(S-C*(2/W))+"Z"}else{return"M"+F+","+S+"L"+P+","+x+"L"+K+","+R+"L"+A+","+H+"L"+T+","+Q+"L"+N.x+","+N.y+"Z"}}if(f.getSource().x==undefined){var b=_metExploreViz.getSessionById(k).getD3Data();var n=b.getNodes();o=n[f.getSource()];u=n[f.getTarget()];if(o.getBiologicalType()=="reaction"){a=o}else{a=u}if(o.x!=undefined&&o.y!=undefined&&u.x!=undefined&&u.y!=undefined){m=r(o,u)}else{m="M0,0L0,0Z"}}else{o=f.getSource();u=f.getTarget();if(o.getBiologicalType()=="reaction"){a=o}else{a=u}if(o.x!=undefined&&o.y!=undefined&&u.x!=undefined&&u.y!=undefined){m=r(o,u)}else{m="M0,0L0,0Z"}}return m},funcPathForFlux3:function(f,b,g,h){var a,e,k;function j(A,L){var K=metExploreD3.getMetaboliteStyle();var I=metExploreD3.getReactionStyle();var H=Math.sqrt(Math.pow(L.x-A.x,2)+Math.pow(L.y-A.y,2));var r=(L.x-A.x);var q=(L.y-A.y);var z=r/Math.abs(r);var y=q/Math.abs(q);if(A.getBiologicalType()=="metabolite"){var F=(Math.abs(H)*I.getWidth()/2)/Math.abs(r);var o=(Math.abs(H)*I.getHeight()/2)/Math.abs(q);var t=(F<o)?rT=F:rt=o}else{var F=(Math.abs(H)*K.getWidth()/2)/Math.abs(r);var o=(Math.abs(H)*K.getHeight()/2)/Math.abs(q);var t=(F<o)?rT=F:rt=o}var B=A.x+r*((H-t)/H);var m=A.y+q*((H-t)/H);var s=5*Math.abs(h);var n=A.x+r*((H-t-s)/H);var v=A.y+q*((H-t-s)/H);widthArrow=2*Math.abs(h);var x=n+q*(widthArrow/H);var D=v-r*(widthArrow/H);var p=n+q*((2*widthArrow/3)/H);var u=v-r*((2*widthArrow/3)/H);var J=1.5*Math.abs(h);var w=A.x+r*(J/H);var l=A.y+q*(J/H);var G=2*Math.abs(h);var E=w+q*((2*G/3)/H);var C=l-r*((2*G/3)/H);return"M"+A.x+","+A.y+"L"+B+","+m+"L"+x+","+D+"L"+p+","+u+"L"+E+","+C+"L"+A.x+","+A.y+"Z"}if(f.getSource().x==undefined){var d=_metExploreViz.getSessionById(b).getD3Data();var c=d.getNodes();a=c[f.getSource()];e=c[f.getTarget()];if(a.x!=undefined&&a.y!=undefined&&e.x!=undefined&&e.y!=undefined){if(h<0){k=j(e,a)}else{k=j(a,e)}}else{k="M0,0L0,0Z"}}else{a=f.getSource();e=f.getTarget();if(a.x!=undefined&&a.y!=undefined&&e.x!=undefined&&e.y!=undefined){if(h<0){k=j(e,a)}else{k=j(a,e)}}else{k="M0,0L0,0Z"}}return k},funcPath1:function(d,b){var f,h,g;function a(v,I){var H=metExploreD3.getMetaboliteStyle();var F=metExploreD3.getReactionStyle();var D=Math.sqrt(Math.pow(I.x-v.x,2)+Math.pow(I.y-v.y,2));var m=(I.x-v.x);var l=(I.y-v.y);var u=m/Math.abs(m);var t=l/Math.abs(l);if(v.getBiologicalType()=="metabolite"){var C=(Math.abs(D)*H.getWidth()/2)/Math.abs(m);var k=(Math.abs(D)*H.getHeight()/2)/Math.abs(l);var s=(C<k)?rT=C:rt=k;var C=(Math.abs(D)*F.getWidth()/2)/Math.abs(m);var k=(Math.abs(D)*F.getHeight()/2)/Math.abs(l);var r=(C<k)?rT=C:rt=k}else{var C=(Math.abs(D)*F.getWidth()/2)/Math.abs(m);var k=(Math.abs(D)*F.getHeight()/2)/Math.abs(l);var s=(C<k)?rT=C:rt=k;var C=(Math.abs(D)*H.getWidth()/2)/Math.abs(m);var k=(Math.abs(D)*H.getHeight()/2)/Math.abs(l);var r=(C<k)?rT=C:rt=k}var o=v.x+m*(1-(D-s)/D);var B=v.y+l*(1-(D-s)/D);var w=v.x+m*((D-r)/D);var j=v.y+l*((D-r)/D);var n=5;var y=v.x+m*((D-r-n)/D);var p=v.y+l*((D-r-n)/D);var x=y+l*(3/D);var E=p-m*(3/D);var A=v.x+m*(1-(D-s-n)/D);var q=v.y+l*(1-(D-s-n)/D);var z=A-l*(3/D);var G=q+m*(3/D);return"M"+o+","+B+"L"+w+","+j+"L"+x+","+E+"L"+y+","+p+"L"+o+","+B+"L"+z+","+G+"L"+A+","+q+"Z"}function g(u,B){var A=metExploreD3.getMetaboliteStyle();var z=metExploreD3.getReactionStyle();var y=Math.sqrt(Math.pow(B.x-u.x,2)+Math.pow(B.y-u.y,2));var n=(B.x-u.x);var m=(B.y-u.y);var t=n/Math.abs(n);var s=m/Math.abs(m);if(u.getBiologicalType()=="metabolite"){var x=(Math.abs(y)*z.getWidth()/2)/Math.abs(n);var l=(Math.abs(y)*z.getHeight()/2)/Math.abs(m);var p=(x<l)?rT=x:rt=l}else{var x=(Math.abs(y)*A.getWidth()/2)/Math.abs(n);var l=(Math.abs(y)*A.getHeight()/2)/Math.abs(m);var p=(x<l)?rT=x:rt=l}var v=u.x+n*((y-p)/y);var j=u.y+m*((y-p)/y);var o=5;var k=u.x+n*((y-p-o)/y);var q=u.y+m*((y-p-o)/y);var r=k+m*(3/y);var w=q-n*(3/y);return"M"+u.x+","+u.y+"L"+v+","+j+"L"+r+","+w+"L"+k+","+q+"Z"}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}return g},funcPath2:function(d,b){var f,h,g;function a(y,L){var K=metExploreD3.getMetaboliteStyle();var J=metExploreD3.getReactionStyle();var I=Math.sqrt(Math.pow(L.x-y.x,2)+Math.pow(L.y-y.y,2));var o=(L.x-y.x);var n=(L.y-y.y);var x=o/Math.abs(o);var w=n/Math.abs(n);if(y.getBiologicalType()=="metabolite"){var F=(Math.abs(I)*J.getWidth()/2)/Math.abs(o);var m=(Math.abs(I)*J.getHeight()/2)/Math.abs(n);var t=(F<m)?rT=F:rt=m}else{var F=(Math.abs(I)*K.getWidth()/2)/Math.abs(o);var m=(Math.abs(I)*K.getHeight()/2)/Math.abs(n);var t=(F<m)?rT=F:rt=m}var q=y.x+o*(1-(I-largeurNoeudS)/I);var E=y.y+n*(1-(I-largeurNoeudS)/I);var A=y.x+o*((I-t)/I);var l=y.y+n*((I-t)/I);var p=5;var C=y.x+o*((I-t-p)/I);var r=y.y+n*((I-t-p)/I);var H=C+n*(3/I);var k=r-o*(3/I);var G=C-n*(3/I);var j=r+o*(3/I);var D=y.x+o*(1-(I-largeurNoeudS-p)/I);var s=y.y+n*(1-(I-largeurNoeudS-p)/I);var v=D-n*(3/I);var B=s+o*(3/I);var u=D+n*(3/I);var z=s-o*(3/I);return"M"+q+","+E+"L"+v+","+B+"L"+D+","+s+"L"+C+","+r+"L"+H+","+k+"L"+A+","+l+"L"+G+","+j+"L"+C+","+r+"L"+D+","+s+"L"+u+","+z+"L"+q+","+E+"Z"}function g(u,C){var B=metExploreD3.getMetaboliteStyle();var A=metExploreD3.getReactionStyle();var y=Math.sqrt(Math.pow(C.x-u.x,2)+Math.pow(C.y-u.y,2));var n=(C.x-u.x);var m=(C.y-u.y);var t=n/Math.abs(n);var s=m/Math.abs(m);if(u.getBiologicalType()=="metabolite"){var q=(A.getWidth()+A.getHeight())/2/2;var r=(B.getHeight()+B.getWidth())/2/2}else{var q=(B.getHeight()+B.getWidth())/2/2;var r=(A.getWidth()+A.getHeight())/2/2}var v=u.x+n*((y-q)/y);var l=u.y+m*((y-q)/y);var o=5;var w=u.x+n*((y-q-o)/y);var p=u.y+m*((y-q-o)/y);var z=w+m*(3/y);var k=p-n*(3/y);var x=w-m*(3/y);var j=p+n*(3/y);return"M"+u.x+","+u.y+"L"+w+","+p+"L"+z+","+k+"L"+v+","+l+"L"+x+","+j+"L"+w+","+p+"Z"}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}return g},funcPath3:function(d,b){var f,h,g;function a(w,F){var E=metExploreD3.getMetaboliteStyle();var D=metExploreD3.getReactionStyle();var C=Math.sqrt(Math.pow(F.x-w.x,2)+Math.pow(F.y-w.y,2));var o=(F.x-w.x);var n=(F.y-w.y);var v=o/Math.abs(o);var u=n/Math.abs(n);if(w.getBiologicalType()=="metabolite"){var z=(Math.abs(C)*D.getWidth()/2)/Math.abs(o);var m=(Math.abs(C)*D.getHeight()/2)/Math.abs(n);var t=(z<m)?rT=z:rt=m}else{var z=(Math.abs(C)*E.getWidth()/2)/Math.abs(o);var m=(Math.abs(C)*E.getHeight()/2)/Math.abs(n);var t=(z<m)?rT=z:rt=m}var q=5;var x=w.x+o*((C-t)/C);var l=w.y+n*((C-t)/C);var q=5;var y=w.x+o*((C-t-q)/C);var s=w.y+n*((C-t-q)/C);var p=w.x+o*((C-t-q-q)/C);var r=w.y+n*((C-t-q-q)/C);var B=y+n*(3/C);var k=s-o*(3/C);var A=y-n*(3/C);var j=s+o*(3/C);return"M"+w.x+","+w.y+"L"+p+","+r+"L"+B+","+k+"L"+A+","+j+"L"+x+","+l+"L"+B+","+k+"L"+A+","+j+"L"+p+","+r+"Z"}function g(u,D){var C=metExploreD3.getMetaboliteStyle();var B=metExploreD3.getReactionStyle();var A=Math.sqrt(Math.pow(D.x-u.x,2)+Math.pow(D.y-u.y,2));var o=(D.x-u.x);var n=(D.y-u.y);var t=o/Math.abs(o);var s=n/Math.abs(n);if(u.getBiologicalType()=="metabolite"){var x=(Math.abs(A)*B.getWidth()/2)/Math.abs(o);var m=(Math.abs(A)*B.getHeight()/2)/Math.abs(n);var r=(x<m)?rT=x:rt=m}else{var x=(Math.abs(A)*C.getWidth()/2)/Math.abs(o);var m=(Math.abs(A)*C.getHeight()/2)/Math.abs(n);var r=(x<m)?rT=x:rt=m}var v=u.x+o*((A-r)/A);var l=u.y+n*((A-r)/A);var p=5;var w=u.x+o*((A-r-p)/A);var q=u.y+n*((A-r-p)/A);var z=w+n*(3/A);var k=q-o*(3/A);var y=w-n*(3/A);var j=q+o*(3/A);return"M"+u.x+","+u.y+"L"+w+","+q+"L"+z+","+k+"L"+v+","+l+"L"+y+","+j+"L"+w+","+q+"Z"}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f!=undefined&&h!=undefined){if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f!=undefined&&h!=undefined){if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{g="M0,0L0,0Z"}}return g},funcPath4:function(d,b){var f,h,g;function a(z,L){var K=metExploreD3.getMetaboliteStyle();var J=metExploreD3.getReactionStyle();var I=Math.sqrt(Math.pow(L.x-z.x,2)+Math.pow(L.y-z.y,2));var n=(L.x-z.x);var m=(L.y-z.y);var y=n/Math.abs(n);var x=m/Math.abs(m);if(z.getBiologicalType()=="metabolite"){var u=(K.getHeight()+K.getWidth())/2/2;var q=z.x+n*(1-(I-u)/I);var E=z.y+m*(1-(I-u)/I);var o=5;var F=z.x+n*(1-(I-u-o)/I);var t=z.y+m*(1-(I-u-o)/I);var p=z.x+n*(1-(I-u-o-o)/I);var s=z.y+m*(1-(I-u-o-o)/I);var w=F-m*(3/I);var C=t+n*(3/I);var v=F+m*(3/I);var B=t-n*(3/I);g="M"+p+","+s+"L"+w+","+C+"L"+v+","+B+"L"+q+","+E+"L"+w+","+C+"L"+v+","+B+"L"+p+","+s+"L"+L.x+","+L.y+"Z"}else{var u=(K.getWidth()+K.getHeight())/2/2;var q=z.x+n*(1-(I-u)/I);var E=z.y+m*(1-(I-u)/I);var o=5;var A=z.x+n*((I-u)/I);var l=z.y+m*((I-u)/I);var o=5;var D=z.x+n*((I-u-o)/I);var r=z.y+m*((I-u-o)/I);var H=D+m*(3/I);var k=r-n*(3/I);var G=D-m*(3/I);var j=r+n*(3/I);var p=z.x+n*((I-u-o-o)/I);var s=z.y+m*((I-u-o-o)/I);g="M"+z.x+","+z.y+"L"+p+","+s+"L"+H+","+k+"L"+G+","+j+"L"+A+","+l+"L"+H+","+k+"L"+G+","+j+"L"+p+","+s+"Z"}return g}function g(x,J){var I=metExploreD3.getMetaboliteStyle();var H=metExploreD3.getReactionStyle();var G=Math.sqrt(Math.pow(J.x-x.x,2)+Math.pow(J.y-x.y,2));var n=(J.x-x.x);var m=(J.y-x.y);var w=n/Math.abs(n);var v=m/Math.abs(m);if(x.getBiologicalType()=="metabolite"){var s=(I.getHeight()+I.getWidth())/2/2;var q=x.x+n*(1-(G-s)/G);var C=x.y+m*(1-(G-s)/G);var o=5;var p=x.x+n*(1-(G-s-o)/G);var E=x.y+m*(1-(G-s-o)/G);var u=q-m*(3/G);var A=C+n*(3/G);var t=q+m*(3/G);var z=C-n*(3/G);return"M"+J.x+","+J.y+"L"+p+","+E+"L"+u+","+A+"L"+q+","+C+"L"+t+","+z+"L"+p+","+E+"Z"}else{var s=(I.getWidth()+I.getHeight())/2/2;var y=x.x+n*((G-s)/G);var l=x.y+m*((G-s)/G);var o=5;var B=x.x+n*((G-s-o)/G);var r=x.y+m*((G-s-o)/G);var F=B+m*(3/G);var k=r-n*(3/G);var D=B-m*(3/G);var j=r+n*(3/G);return"M"+x.x+","+x.y+"L"+B+","+r+"L"+F+","+k+"L"+y+","+l+"L"+D+","+j+"L"+B+","+r+"Z"}return g}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}return g},funcPath5:function(d,b){var f,h,g;function a(B,Q){var P=metExploreD3.getMetaboliteStyle();var O=metExploreD3.getReactionStyle();var N=Math.sqrt(Math.pow(Q.x-B.x,2)+Math.pow(Q.y-B.y,2));var o=(Q.x-B.x);var n=(Q.y-B.y);var A=o/Math.abs(o);var z=n/Math.abs(n);if(B.getBiologicalType()=="metabolite"){var I=(Math.abs(N)*O.getWidth()/2)/Math.abs(o);var m=(Math.abs(N)*O.getHeight()/2)/Math.abs(n);var v=(I<m)?rT=I:rt=m}else{var I=(Math.abs(N)*P.getWidth()/2)/Math.abs(o);var m=(Math.abs(N)*P.getHeight()/2)/Math.abs(n);var v=(I<m)?rT=I:rt=m}var w=(P.getHeight()+P.getWidth())/2/2;var s=B.x+o*(1-(N-w)/N);var G=B.y+n*(1-(N-w)/N);var p=5;var H=B.x+o*(1-(N-w-p)/N);var u=B.y+n*(1-(N-w-p)/N);var L=B.x+o*(1-(N-w-p-p)/N);var r=B.y+n*(1-(N-w-p-p)/N);var y=H-n*(3/N);var E=u+o*(3/N);var x=H+n*(3/N);var D=u-o*(3/N);var C=B.x+o*((N-w)/N);var l=B.y+n*((N-w)/N);var F=B.x+o*((N-w-p)/N);var t=B.y+n*((N-w-p)/N);var M=F+n*(3/N);var k=t-o*(3/N);var K=F-n*(3/N);var j=t+o*(3/N);var J=B.x+o*((N-w-p-p)/N);var q=B.y+n*((N-w-p-p)/N);return"M"+s+","+G+"L"+y+","+E+"L"+x+","+D+"M"+J+","+q+"L"+M+","+k+"L"+K+","+j+"M"+L+","+r+"L"+y+","+E+"L"+x+","+D+"L"+s+","+G+"L"+y+","+E+"L"+x+","+D+"L"+L+","+r+"L"+J+","+q+"L"+M+","+k+"L"+K+","+j+"L"+C+","+l+"L"+M+","+k+"L"+K+","+j+"L"+J+","+q+"Z"}function g(y,K){var J=metExploreD3.getMetaboliteStyle();var I=metExploreD3.getReactionStyle();var H=Math.sqrt(Math.pow(K.x-y.x,2)+Math.pow(K.y-y.y,2));var n=(K.x-y.x);var m=(K.y-y.y);var x=n/Math.abs(n);var w=m/Math.abs(m);if(y.getBiologicalType()=="metabolite"){var s=(I.getWidth()+I.getHeight())/2/2;var t=(J.getHeight()+J.getWidth())/2/2}else{var s=(J.getHeight()+J.getWidth())/2/2;var t=(I.getWidth()+I.getHeight())/2/2}var q=y.x+n*(1-(H-t)/H);var D=y.y+m*(1-(H-t)/H);var A=y.x+n*((H-s)/H);var l=y.y+m*((H-s)/H);var o=5;var C=y.x+n*((H-s-o)/H);var r=y.y+m*((H-s-o)/H);var G=C+m*(3/H);var k=r-n*(3/H);var F=C-m*(3/H);var j=r+n*(3/H);var p=y.x+n*(1-(H-t-o)/H);var E=y.y+m*(1-(H-t-o)/H);var v=q-m*(3/H);var B=D+n*(3/H);var u=q+m*(3/H);var z=D-n*(3/H);return"M"+p+","+E+"L"+v+","+B+"L"+u+","+z+"L"+p+","+E+"L"+C+","+r+"L"+G+","+k+"L"+A+","+l+"L"+F+","+j+"L"+C+","+r+"Z"}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}return g},funcPath6:function(d,b){var f,h,g;function a(y,L){var K=metExploreD3.getMetaboliteStyle();var J=metExploreD3.getReactionStyle();var I=Math.sqrt(Math.pow(L.x-y.x,2)+Math.pow(L.y-y.y,2));var o=(L.x-y.x);var n=(L.y-y.y);var x=o/Math.abs(o);var w=n/Math.abs(n);if(y.getBiologicalType()=="metabolite"){var F=(Math.abs(I)*J.getWidth()/2)/Math.abs(o);var m=(Math.abs(I)*J.getHeight()/2)/Math.abs(n);var t=(F<m)?rT=F:rt=m}else{var F=(Math.abs(I)*K.getWidth()/2)/Math.abs(o);var m=(Math.abs(I)*K.getHeight()/2)/Math.abs(n);var t=(F<m)?rT=F:rt=m}var q=y.x+o*(1-(I-largeurNoeudS)/I);var E=y.y+n*(1-(I-largeurNoeudS)/I);var A=y.x+o*((I-t)/I);var l=y.y+n*((I-t)/I);var p=5;var C=y.x+o*((I-t-p)/I);var r=y.y+n*((I-t-p)/I);var H=C+n*(3/I);var k=r-o*(3/I);var G=C-n*(3/I);var j=r+o*(3/I);var D=y.x+o*(1-(I-largeurNoeudS-p)/I);var s=y.y+n*(1-(I-largeurNoeudS-p)/I);var v=D-n*(3/I);var B=s+o*(3/I);var u=D+n*(3/I);var z=s-o*(3/I);return"M"+q+","+E+"L"+v+","+B+"L"+u+","+z+"M"+q+","+E+"L"+v+","+B+"L"+D+","+s+"L"+C+","+r+"L"+H+","+k+"L"+A+","+l+"L"+G+","+j+"L"+C+","+r+"L"+D+","+s+"L"+u+","+z+"L"+q+","+E+"Z"}function g(u,C){var B=metExploreD3.getMetaboliteStyle();var A=metExploreD3.getReactionStyle();var y=Math.sqrt(Math.pow(C.x-u.x,2)+Math.pow(C.y-u.y,2));var n=(C.x-u.x);var m=(C.y-u.y);var t=n/Math.abs(n);var s=m/Math.abs(m);if(u.getBiologicalType()=="metabolite"){var q=(A.getWidth()+A.getHeight())/2/2;var r=(B.getHeight()+B.getWidth())/2/2}else{var q=(B.getHeight()+B.getWidth())/2/2;var r=(A.getWidth()+A.getHeight())/2/2}var v=u.x+n*((y-q)/y);var l=u.y+m*((y-q)/y);var o=5;var w=u.x+n*((y-q-o)/y);var p=u.y+m*((y-q-o)/y);var z=w+m*(3/y);var k=p-n*(3/y);var x=w-m*(3/y);var j=p+n*(3/y);return"M"+u.x+","+u.y+"L"+w+","+p+"L"+z+","+k+"L"+v+","+l+"L"+x+","+j+"L"+w+","+p+"Z"}if(d.getSource().x==undefined){var e=_metExploreViz.getSessionById(b).getD3Data();var c=e.getNodes();f=c[d.getSource()];h=c[d.getTarget()];if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}else{f=d.getSource();h=d.getTarget();if(f.x!=undefined&&f.y!=undefined&&h.x!=undefined&&h.y!=undefined){if(f.getReactionReversibility()||h.getReactionReversibility()){g=a(f,h)}else{g=g(f,h)}}else{g="M0,0L0,0Z"}}return g},refreshLink1:function(c,g,b,f){metExploreD3.GraphLink.panelParent="#"+c;var e=g.getD3Data();var a=20;var d=b.getMarkerWidth()/2;metExploreD3.GraphLink.link=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").data(e.getLinks()).enter().append("svg:path").attr("class",String).attr("d",function(h){return metExploreD3.GraphLink.funcPath1(h,c)}).attr("class","link").attr("fill-rule","evenodd").attr("fill",function(h){if(h.interaction=="out"){return b.getMarkerOutColor()}else{return b.getMarkerInColor()}}).style("stroke",b.getStrokeColor()).style("stroke-width",0.5).style("stroke-linejoin","bevel")},refreshLink:function(c,g,b,f){metExploreD3.GraphLink.panelParent="#"+c;var e=g.getD3Data();var a=20;var d=b.getMarkerWidth()/2;d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").remove();d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").data(e.getLinks()).enter().insert("svg:g",":first-child").append("svg:path").attr("class",String).attr("d",function(h){return metExploreD3.GraphLink.funcPath3(h,c,this.id,3)}).attr("class","link").attr("fill-rule","evenodd").attr("fill",function(h){if(h.interaction=="out"){return b.getMarkerOutColor()}else{return b.getMarkerInColor()}}).style("stroke",b.getStrokeColor()).style("stroke-width",0.5).style("opacity",1).style("stroke-dasharray",null);metExploreD3.GraphLink.link=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link")},loadLinksForFlux:function(c,d,b,e){d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").remove();_metExploreViz.getSessionById(c).setMappingDataType("Flux");var a=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("path.link").data(d.getLinks()).enter().insert("svg:g",":first-child");a.each(function(f){d3.select(this).append("svg:path").attr("class",String).attr("d",function(g){return metExploreD3.GraphLink.funcPathForFlux(g,c,this.id)}).attr("class","link").attr("fill-rule","evenodd").style("stroke",b.getStrokeColor()).style("stroke-width",0.5).on("mouseover",function(n){var m,j,g,l;if(n.getSource().getBiologicalType()=="reaction"){m=n.getSource();j=n.getTarget()}else{m=n.getTarget();j=n.getSource()}g=n.getSource();l=n.getTarget();var q=_metExploreViz.getSessionById("viz").getActiveMapping();var h=_metExploreViz.getMappingByName(q);var p=h.getConditions();var o=m.getMappingDataByNameAndCond(q,p[0]);if(o!=null){var r=o.getMapValue();if(r<0){l=n.getSource();g=n.getTarget()}}if(!document.getElementById("tooltip2").classList.contains("fixed")){var k="Name: "+n.id+"<br/><b>Source:</b> "+g.getName()+"<br/><b>Target:</b> "+l.getName()+((r!=undefined)?"<br/>Flux: "+Math.abs(r):"");k+="<br/>";document.getElementById("tooltip2").innerHTML=k;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseout",function(g){document.getElementById("tooltip2").classList.add("hide")});d3.select(this).append("svg:path").attr("class",String).attr("id","linkRev").attr("d",function(g){return metExploreD3.GraphLink.funcPathForFlux(g,c,this.id)}).attr("class","link").attr("fill-rule","evenodd").style("stroke",b.getStrokeColor()).style("stroke-width",0.5).on("mouseover",function(n){var m,j,g,l;if(n.getSource().getBiologicalType()=="reaction"){m=n.getSource();j=n.getTarget()}else{m=n.getTarget();j=n.getSource()}g=n.getSource();l=n.getTarget();var q=_metExploreViz.getSessionById("viz").getActiveMapping();var h=_metExploreViz.getMappingByName(q);var p=h.getConditions();var o=m.getMappingDataByNameAndCond(q,p[1]);if(o!=null){var r=o.getMapValue();if(r<0){l=n.getSource();g=n.getTarget()}}if(!document.getElementById("tooltip2").classList.contains("fixed")){var k="Name: "+n.id+"<br/><b>Source: </b>"+g.getName()+"<br/><b>Target: </b>"+l.getName()+((r!=undefined)?"<br/>Flux: "+Math.abs(r):"");k+="<br/>";document.getElementById("tooltip2").innerHTML=k;document.getElementById("tooltip2").classList.remove("hide")}}).on("mouseout",function(g){document.getElementById("tooltip2").classList.add("hide")})});metExploreD3.GraphNetwork.tick("viz")},reloadLinks:function(a,c,b,d){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("path.link").data(c.getLinks()).enter().insert("path",":first-child").attr("class",String).attr("d",function(e){return metExploreD3.GraphLink.funcPath3(e,parent,this.id,3)}).attr("class","link").attr("fill-rule","evenodd").attr("fill",function(e){if(e.interaction=="out"){return b.getMarkerOutColor()}else{return b.getMarkerInColor()}}).style("stroke",b.getStrokeColor()).style("stroke-width",0.5).style("stroke-linejoin","bevel")},linkTypeOfMetabolite:function(){_metExploreViz.setLinkedByTypeOfMetabolite(true);var b="viz";var d=_metExploreViz.getSessionById("viz");if(d!=undefined){var c=d.getForce();if(c!=undefined){c.stop()}}var a=metExploreD3.createLoadMask("Link in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var l={};var m={};var j={};var k={};d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("path.link").filter(function(n){return n.getInteraction()!="hiddenForce"}).each(function(n){if(n.getInteraction()=="in"){if(l[n.getTarget()]==null){l[n.getTarget()]=[]}l[n.getTarget()][l[n.getTarget()].length]=n.getSource();if(k[n.getSource()]==null){k[n.getSource()]=[]}k[n.getSource()][k[n.getSource()].length]=n.getTarget()}else{if(m[n.getSource()]==null){m[n.getSource()]=[]}m[n.getSource()][m[n.getSource()].length]=n.getTarget();if(j[n.getTarget()]==null){j[n.getTarget()]=[]}j[n.getTarget()][j[n.getTarget()].length]=n.getSource()}});for(var f in l){var e=-1;l[f].forEach(function(n){e++;l[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete l[f][e]})}for(var f in m){var e=-1;m[f].forEach(function(n){e++;m[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete m[f][e]})}for(var f in j){var e=-1;j[f].forEach(function(n){e++;j[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete j[f][e]})}for(var f in k){var e=-1;k[f].forEach(function(n){e++;k[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete k[f][e]})}metExploreD3.hideMask(a);var g=metExploreD3.GraphNetwork.isAnimated(d.getId());if(g=="true"){var h=d.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(d.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(d.getId())==null)){h.start()}}}},100)}},removeLinkTypeOfMetabolite:function(){_metExploreViz.setLinkedByTypeOfMetabolite(false);var b="viz";var d=_metExploreViz.getSessionById("viz");if(d!=undefined){var c=d.getForce();if(c!=undefined){c.stop()}}var a=metExploreD3.createLoadMask("Remove hidden link in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){metExploreD3.GraphLink.removeHiddenLinkInDrawing("viz");metExploreD3.hideMask(a);var e=metExploreD3.GraphNetwork.isAnimated(d.getId());if(e=="true"){var f=d.getForce();if(f!=undefined){if((metExploreD3.GraphNetwork.isAnimated(d.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(d.getId())==null)){f.start()}}}},100)}},addHiddenLinkInDrawing:function(g,a,f,b){var j=_metExploreViz.getSessionById(b);var d=j.getD3Data();d.addLink(g,a,f,"hiddenForce",false);var h=metExploreD3.getMetaboliteStyle();var e=metExploreD3.getLinkStyle();var c=j.getForce();link=d3.select("#"+b).select("#graphComponent").selectAll("path.link").data(c.links(),function(k){return k.source.id+"-"+k.target.id}).enter().insert("path",":first-child").attr("class","link").style("stroke",e.getStrokeColor()).style("opacity",0)},removeHiddenLinkInDrawing:function(b){var f=_metExploreViz.getSessionById(b);var e=f.getD3Data();var a=[];var d=f.getForce();var c=d3.select("#"+b).select("#graphComponent").selectAll("path.link").filter(function(g){return g.getInteraction()=="hiddenForce"}).each(function(g){a.push(g)}).remove();setTimeout(function(){for(i=0;i<a.length;i++){var h=a[i];e.removeLink(h);var g=d.links().indexOf(h);if(g!=-1){d.links().splice(g,1)}}},100)},tick:function(a,c){var b=_metExploreViz.getSessionById(a).getMappingDataType()=="Flux";if(b){funcPath=metExploreD3.GraphLink.funcPathForFlux}else{funcPath=metExploreD3.GraphLink.funcPath3}d3.select("#"+metExploreD3.GraphNode.panelParent).select("#D3viz").selectAll("path").filter(function(e){return $(this).attr("class")!="linkCaptionRev"&&$(this).attr("class")!="link"}).attr("d",metExploreD3.GraphNode.groupPath).attr("transform",d3.select("#"+a).select("#D3viz").select("#graphComponent").attr("transform"));d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("path.link").attr("d",function(d){return funcPath(d,a,this.id)}).style("stroke-linejoin","bevel")},displayConvexhulls:function(b){var c=_metExploreViz.getGeneralStyle();var d=d3.select("#"+b).select("#D3viz").selectAll("path").filter(function(e){return $(this).attr("class")!="linkCaptionRev"&&$(this).attr("class")!="link"});var a=c.isDisplayedConvexhulls();if(!a){d.remove()}else{if(d[0].length==0){metExploreD3.GraphNode.loadPath(b,a)}d=d3.select("#"+b).select("#D3viz").selectAll("path").filter(function(e){return $(this).attr("class")!="linkCaptionRev"&&$(this).attr("class")!="link"});d.attr("d",metExploreD3.GraphNode.groupPath).attr("transform",d3.select("#"+b).select("#D3viz").select("#graphComponent").attr("transform"))}}};